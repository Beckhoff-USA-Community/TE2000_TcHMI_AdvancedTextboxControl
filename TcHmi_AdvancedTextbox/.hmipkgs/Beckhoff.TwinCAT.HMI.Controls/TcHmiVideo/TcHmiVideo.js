var TcHmi,__extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();!function(e){!function(t){!function(t){var i=function(t){function i(i,o,n){var _=t.call(this,i,o,n)||this;return _.__duration=0,_.__currentTime=0,_.__runtimeWidthNeededForHeight=!1,_.__runtimeHeightNeededForWidth=!1,_.__onResizedEventDestroyEvent=null,_.__onError=function(t){t.currentTarget instanceof HTMLElement&&(t.currentTarget instanceof HTMLSourceElement&&t.currentTarget.nextElementSibling&&t.currentTarget.nextElementSibling instanceof HTMLSourceElement||(e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiVideo, Id="+_.getId()+"] Could not load or play any requested video files. Perhaps the file format is not supported on this device."),!0===_.getIsEnabled()&&("Content"===_.getHeightMode()&&_.__processHeight(),"Content"===_.getWidthMode()&&_.__processWidth(),e.EventProvider.raise(_.__id+".onError",t),e.EventProvider.raise(_.__id+".onFunctionResultChanged",["getOriginalWidth","getOriginalHeight","getCurrentTime","getIsPlaying"]))))},_.__onPlayingChange=function(t){e.EventProvider.raise(_.__id+".onFunctionResultChanged",["getCurrentTime","getIsPlaying"]),e.EventProvider.raise(_.__id+".onIsPlayingChange",!_.__elemVideo.paused)},_.__onResolverForSrcListWatchCallback=function(t){!1===_.__isAttached&&_.__suspendObjectResolver("srcList"),t.error===e.Errors.NONE?tchmi_equal(t.value,_.__srcList)||(_.__srcList=t.value,e.EventProvider.raise(_.__id+".onFunctionResultChanged",["getSrcList"]),_.__processSrcList()):e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiVideo, Id="+_.getId()+", Attribute=SrcList] Resolving symbols from object failed with error: "+e.Log.buildMessage(t.details))},_.__loadeddataHandler=_.__onLoadedData(),_.__volumechangeHandler=_.__onVolumeChange(),_.__ratechangeHandler=_.__onRateChange(),_.__durationchangeHandler=_.__onDurationChange(),_.__timeupdateHandler=_.__onTimeUpdate(),_.__endedHandler=_.__onEnded(),_}return __extends(i,t),i.prototype.__previnit=function(){this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiVideo-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-video-template")),this.__elementBorder=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiVideo-template-border"),0===this.__elementBorder.length&&(this.__elementBorder=this.__elementTemplateRoot.find(".tchmi-video-template-border")),this.__elementFocusBorder=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiVideo-template-focus-border"),0===this.__elementFocusBorder.length&&(this.__elementFocusBorder=this.__elementTemplateRoot.find(".tchmi-video-template-focus-border"));var e=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiVideo-template-content");if(0===e.length&&(e=this.__elementTemplateRoot.find(".tchmi-video-template-content")),0===this.__elementTemplateRoot.length||0===this.__elementBorder.length||0===this.__elementFocusBorder.length||0===e.length)throw new Error("Invalid Template.html");this.__elemVideo=e[0],t.prototype.__previnit.call(this)},i.prototype.__init=function(){t.prototype.__init.call(this);var e={passive:!0,capture:!1};this.__elemVideo.addEventListener("loadeddata",this.__loadeddataHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("error",this.__onError,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("volumechange",this.__volumechangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("ratechange",this.__ratechangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("durationchange",this.__durationchangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("timeupdate",this.__timeupdateHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("ended",this.__endedHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("playing",this.__onPlayingChange,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.addEventListener("pause",this.__onPlayingChange,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e)},i.prototype.__attach=function(){t.prototype.__attach.call(this),this.__processControls(),e.Access.checkAccess(this,"observe")&&this.getIsEnabled()&&this.__elemVideo.load()},i.prototype.__detach=function(){t.prototype.__detach.call(this),null!==this.__onResizedEventDestroyEvent&&(this.__onResizedEventDestroyEvent(),this.__onResizedEventDestroyEvent=null)},i.prototype.destroy=function(){if(!this.__keepAlive){var e={passive:!0,capture:!1};this.__elemVideo.removeEventListener("loadeddata",this.__loadeddataHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("error",this.__onError,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("volumechange",this.__volumechangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("ratechange",this.__ratechangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("durationchange",this.__durationchangeHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("timeupdate",this.__timeupdateHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("ended",this.__endedHandler,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("playing",this.__onPlayingChange,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),this.__elemVideo.removeEventListener("pause",this.__onPlayingChange,!!TCHMI_EVENT_OPTION_OBJECT_SUPPORTED&&e),t.prototype.destroy.call(this)}},i.prototype.__onResized=function(){var e=this;return function(t,i){!0===e.__runtimeHeightNeededForWidth?e.__processWidth():!0===e.__runtimeWidthNeededForHeight&&e.__processHeight()}},i.prototype.__processWidth=function(){if("Content"===this.getWidthMode()){var i="",o=this.__getContentWidth();null!==o&&(i=o+"px"),e.StyleProvider.setSimpleElementStyle(this.__element,"width",i)}t.prototype.__processWidth.call(this),"Content"===this.getHeightMode()&&"Content"!==this.getWidthMode()&&this.__processHeight()},i.prototype.__processHeight=function(){if("Content"===this.getHeightMode()){this.__intHeight=null;var e=this.__getContentHeight();null!==e&&(this.__intHeight=e+"px")}t.prototype.__processHeight.call(this),"Content"===this.getWidthMode()&&"Content"!==this.getHeightMode()&&this.__processWidth()},i.prototype.setWidthMode=function(valueNew){var t=e.ValueConverter.toSizeModeWithContent(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("WidthMode")),t!==this.__widthMode&&(this.__widthMode=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getWidthMode"]),this.__processWidthMode(),"Content"===t&&"Content"===this.getHeightMode()&&this.__processHeightMode())},i.prototype.setHeightMode=function(valueNew){var t=e.ValueConverter.toSizeModeWithContent(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("HeightMode")),t!==this.__heightMode&&(this.__heightMode=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeightMode"]),this.__processHeightMode(),"Content"===t&&"Content"===this.getHeightMode()&&this.__processWidthMode())},i.prototype.__getContentWidth=function(){this.__runtimeHeightNeededForWidth=!1;return"Content"!==this.getWidthMode()?t.prototype.__getContentWidth.call(this):this.__srcList?"px"!==this.__widthUnit?null:TCHMI_DESIGNER?320:0===this.__elemVideo.videoHeight||0===this.__elemVideo.videoWidth?null:"Content"===this.getHeightMode()?this.__elemVideo.videoWidth:null!==this.__height&&void 0!==this.__height&&"Value"===this.getHeightMode()?this.__height*this.__elemVideo.videoWidth/this.__elemVideo.videoHeight:(this.__runtimeHeightNeededForWidth=!0,null===this.__onResizedEventDestroyEvent&&(this.__onResizedEventDestroyEvent=e.EventProvider.register(this.__id+".onResized",this.__onResized())),!1===this.__isAttached?null:this.__element.height()*this.__elemVideo.videoWidth/this.__elemVideo.videoHeight):null},i.prototype.__getContentHeight=function(){this.__runtimeWidthNeededForHeight=!1;return"Content"!==this.getHeightMode()?t.prototype.__getContentHeight.call(this):this.__srcList?"px"!==this.__heightUnit?null:TCHMI_DESIGNER?240:0===this.__elemVideo.videoHeight||0===this.__elemVideo.videoWidth?null:"Content"===this.getWidthMode()?this.__elemVideo.videoHeight:null!==this.__width&&void 0!==this.__width&&"Value"===this.getWidthMode()?this.__width*this.__elemVideo.videoHeight/this.__elemVideo.videoWidth:(this.__runtimeWidthNeededForHeight=!0,null===this.__onResizedEventDestroyEvent&&(this.__onResizedEventDestroyEvent=e.EventProvider.register(this.__id+".onResized",this.__onResized())),!1===this.__isAttached?null:this.__element.width()*this.__elemVideo.videoHeight/this.__elemVideo.videoWidth):null},i.prototype.__processAccessConfig=function(){t.prototype.__processAccessConfig.call(this),this.__processSrcList(),this.__processPoster()},i.prototype.__processIsEnabled=function(){t.prototype.__processIsEnabled.call(this),this.__processSrcList(),this.__processPoster()},i.prototype.__onLoadedData=function(){var t=this;return function(i){void 0!==t.__playbackrate&&null!==t.__playbackrate&&t.__processPlaybackrate(),"Content"===t.getHeightMode()&&t.__processHeight(),"Content"===t.getWidthMode()&&t.__processWidth(),e.EventProvider.raise(t.__id+".onLoadedData"),e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getOriginalWidth","getOriginalHeight","getCurrentTime","getIsPlaying"])}},i.prototype.__onVolumeChange=function(){var t=this;return function(i){var o=t.__elemVideo.volume,n=t.__elemVideo.muted;n!==t.__mute&&(t.__mute=n,e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getMute"])),o!==t.__volume&&(t.__volume=o,e.EventProvider.raise(t.__id+".onVolumeChange",t.__volume),e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getVolume"]),t.__volume>0&&t.__mute?(t.__mute=!1,e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getMute"])):0===t.__volume&&!0===t.__mute&&(t.__mute=!0,e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getMute"])))}},i.prototype.__onDurationChange=function(){var t=this;return function(i){t.__duration=t.__elemVideo.duration,isNaN(t.__duration)&&(t.__duration=0),e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getDuration"]),e.EventProvider.raise(t.__id+".onDurationChange",t.__duration)}},i.prototype.__onEnded=function(){var t=this;return function(i){e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getIsEnded"]),e.EventProvider.raise(t.__id+".onIsEndedChange",t.__elemVideo.ended)}},i.prototype.__onRateChange=function(){var t=this;return function(i){t.__playbackrate=t.__elemVideo.playbackRate,e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getPlaybackrate"])}},i.prototype.__onTimeUpdate=function(){var t=this;return function(i){t.__currentTime=t.__elemVideo.currentTime,e.EventProvider.raise(t.__id+".onFunctionResultChanged",["getCurrentTime"]),e.EventProvider.raise(t.__id+".onTimeUpdate")}},i.prototype.getDuration=function(){return this.__duration},i.prototype.getIsEnded=function(){return this.__elemVideo.ended},i.prototype.getIsPlaying=function(){return!this.__elemVideo.paused},i.prototype.setSrcList=function(valueNew){var t=e.ValueConverter.toObject(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("SrcList"));var i=this.__objectResolvers.get("srcList");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());var o=new e.Symbol.ObjectResolver(t);this.__objectResolvers.set("srcList",{resolver:o,watchCallback:this.__onResolverForSrcListWatchCallback,watchDestroyer:o.watch(this.__onResolverForSrcListWatchCallback)})},i.prototype.getSrcList=function(){return this.__srcList},i.prototype.__processSrcList=function(){var t=this;if(!0!==TCHMI_DESIGNER){var i=function(){for(;t.__elemVideo.firstChild;)t.__elemVideo.removeChild(t.__elemVideo.firstChild)};if(!0===e.Access.checkAccess(this,"observe"))if(!1!==this.getIsEnabled()){var o=!1;if(this.__srcList){for(var n=this.__srcList.length;this.__elemVideo.childElementCount>n;)this.__elemVideo.removeChild(this.__elemVideo.lastElementChild);for(var _=0;_<n;_++){var r=this.__srcList[_],s=void 0;_<this.__elemVideo.childElementCount?s=this.__elemVideo.children[_]:(s=document.createElement("source")).addEventListener("error",this.__onError),r.source!==s.getAttribute("src")&&(s.src=r.source,o=!0),r.type!==s.type&&(s.type=r.type,o=!0),s.parentElement||this.__elemVideo.insertBefore(s,this.__elemVideo.lastElementChild?this.__elemVideo.lastElementChild.nextSibling:null)}this.__elemVideo.lastChild&&this.__elemVideo.lastChild.nodeType!==Node.TEXT_NODE&&this.__elemVideo.appendChild(document.createTextNode("HTML5 Video support is missing..."))}else this.__elemVideo.childElementCount&&(o=!0,i());o&&this.__elemVideo.load(),e.EventProvider.raise(this.__id+".onIsPlayingChange",!this.__elemVideo.paused)}else i();else i()}},i.prototype.play=function(){if(!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()){var t=this.__elemVideo.play();void 0!==t&&t.then(function(e){}).catch(function(t){e.Log.warn("[Source=Framework, Module=TcHmi.System.ThemeManager] Video playback was prevented. Please set video control to mute or activate video with user interaction.")})}},i.prototype.pause=function(){!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()&&this.__elemVideo.pause()},i.prototype.stop=function(){!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()&&(this.__currentTime=0,this.__elemVideo.currentTime=0,this.pause())},i.prototype.skipBackward=function(valueNew){!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()&&null!=valueNew&&(isNaN(valueNew)||(this.__elemVideo.currentTime-=-valueNew))},i.prototype.skipForward=function(valueNew){!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()&&null!=valueNew&&(isNaN(valueNew)||(this.__elemVideo.currentTime+=valueNew))},i.prototype.setCurrentTime=function(valueNew){if(!0===e.Access.checkAccess(this,"operate")&&!1!==this.getIsEnabled()){var t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("CurrentTime")),t!==this.__currentTime&&null!==t&&(this.__currentTime=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getCurrentTime"]),this.__processCurrentTime())}},i.prototype.getCurrentTime=function(){return this.__currentTime},i.prototype.__processCurrentTime=function(){this.__elemVideo.currentTime=this.__currentTime},i.prototype.setControls=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Controls")),t!==this.__controls&&(this.__controls=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getControls"]),this.__processControls())},i.prototype.getControls=function(){return this.__controls},i.prototype.__processControls=function(){void 0!==this.__controls&&(!0===e.Access.checkAccess(this,"operate")?this.__elemVideo.controls=this.__controls:this.__elemVideo.controls=!1)},i.prototype.setVolume=function(valueNew){var t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Volume")),t!==this.__volume&&(this.__volume=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getVolume"]),this.__processVolume())},i.prototype.getVolume=function(){return this.__volume},i.prototype.__processVolume=function(){if(void 0!==this.__volume){var e=this.__volume;e=(e=e<0?0:e)>1?1:e,this.__elemVideo.volume=e}},i.prototype.setAutoplay=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Autoplay")),t!==this.__autoplay&&(this.__autoplay=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAutoplay"]),this.__processAutoplay())},i.prototype.getAutoplay=function(){return this.__autoplay},i.prototype.__processAutoplay=function(){void 0!==this.__autoplay&&(this.__elemVideo.autoplay=this.__autoplay)},i.prototype.setMute=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Mute")),t!==this.__mute&&(this.__mute=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getMute"]),this.__processMute())},i.prototype.getMute=function(){return this.__mute},i.prototype.__processMute=function(){void 0!==this.__mute&&(this.__elemVideo.muted=this.__mute)},i.prototype.setLoop=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Loop")),t!==this.__loop&&(this.__loop=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getLoop"]),this.__processLoop())},i.prototype.getLoop=function(){return this.__loop},i.prototype.__processLoop=function(){void 0!==this.__loop&&(this.__elemVideo.loop=this.__loop)},i.prototype.setPoster=function(valueNew){var t=e.ValueConverter.toString(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Poster")),t!==this.__poster&&(this.__poster=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getPoster"]),this.__processPoster())},i.prototype.getPoster=function(){return this.__poster},i.prototype.__processPoster=function(){!0===e.Access.checkAccess(this,"observe")&&!1!==this.getIsEnabled()&&(this.__poster?this.__elemVideo.poster=this.__poster:this.__elemVideo.poster="")},i.prototype.setPlaybackrate=function(valueNew){var t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Playbackrate")),t!==this.__playbackrate&&(this.__playbackrate=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getPlaybackrate"]),this.__processPlaybackrate())},i.prototype.getPlaybackrate=function(){return this.__playbackrate},i.prototype.__processPlaybackrate=function(){if(null!==this.__playbackrate&&void 0!==this.__playbackrate)try{this.__elemVideo.playbackRate=this.__playbackrate}catch(e){}},i.prototype.getOriginalWidth=function(){return this.__elemVideo.videoWidth},i.prototype.getOriginalHeight=function(){return this.__elemVideo.videoHeight},i}(e.Controls.System.TcHmiControl);t.TcHmiVideo=i}(t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiVideo","TcHmi.Controls.Beckhoff",e.Controls.Beckhoff.TcHmiVideo)}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));