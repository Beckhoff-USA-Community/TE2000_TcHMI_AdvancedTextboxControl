var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){!function(t){!function(n){var i=function(i){function o(o,r,l){var a=i.call(this,o,r,l)||this;return a.__filterInternal=[],a.__internalColumns=[],a.__storageValidation={filter:{function:"getFilter",expectedResult:void 0},columns:{function:"getColumns",expectedResult:void 0}},a.__sortingInitialized=!1,a.__headerFontFamilyInitialized=!1,a.__headerFontSizeInitialized=!1,a.__headerFontSizeUnitInitialized=!1,a.__headerFontStyleInitialized=!1,a.__headerFontWeightInitialized=!1,a.__gridFontFamilyInitialized=!1,a.__gridFontSizeInitialized=!1,a.__gridFontSizeUnitInitialized=!1,a.__gridFontStyleInitialized=!1,a.__gridFontWeightInitialized=!1,a.__headerHeightInitialized=!1,a.__headerHeightUnitInitialized=!1,a.__rowHeightInitialized=!1,a.__typeToggles={message:null,alarm:null},a.__typeTogglesOrder=["alarm","message"],a.__severityToggles={verbose:null,info:null,warning:null,error:null,critical:null},a.__severityTogglesOrder=["verbose","info","warning","error","critical"],a.__menuBarButtons={filter:null,columns:null,confirm:null,confirmAll:null},a.__menuBarButtonsOrder=["filter","columns","confirm","confirmAll"],a.__buttonTooltips={message:"Toggle displaying of messages",alarm:"Toggle displaying of alarms",verbose:"Toggle displaying of verbose events",info:"Toggle displaying of info events",warning:"Toggle displaying of warning events",error:"Toggle displaying of error events",critical:"Toggle displaying of critical events",filter:"Configure filters",columns:"Configure displayed columns",confirm:"Confirm selected alarm",confirmAll:"Confirm all unconfirmed alarms"},a.__canConfirm=!0,a.__filterPopup=null,a.__columnsPopup=null,a.__detailsPopup=null,a.__confirmAllPopup=null,a.__typesToShow={0:!0,1:!0},a.__severitiesToShow={0:!0,1:!0,2:!0,3:!0,4:!0},a.__availableColumns={severity:{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/critical.svg"}]},type:{name:"type",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Message",value:0,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/message.svg"},{text:"Alarm",value:1,height:30,width:30,source:t.getBasePathEx(a)+"/Themes/Base/Images/alarm.svg"}]},domain:{name:"domain",label:"Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},sourceDomain:{name:"sourceDomain",label:"Source Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},name:{name:"name",label:"Name",control:"TextBlock",width:200,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},text:{name:"text",label:"Text",control:"TextBlock",width:373,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},alarmState:{name:"alarmState",label:"",control:"TextBlock",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateRaised:{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeRaised:{name:"timeRaised",label:"Time Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateRaised:{name:"timeRaised",label:"Date Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateConfirmed:{name:"timeConfirmed",label:"Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeConfirmed:{name:"timeConfirmed",label:"Time Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateConfirmed:{name:"timeConfirmed",label:"Date Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateCleared:{name:"timeCleared",label:"Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeCleared:{name:"timeCleared",label:"Time Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateCleared:{name:"timeCleared",label:"Date Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"}},a.__destroyersToCallOnDetach=[],a.__serverEventConsumerDestroyer=null,a.__onUserInGroupChangedDestroyer=null,a.__doubletapStartTime=0,a.__consumeEventList=function(t){a.__events.clearAll(),t.error===e.Errors.NONE?t.events&&a.__events.addRange(t.events):e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+a.getId()+"] Unable to list events: "+e.Log.buildMessage(t.details)),a.__datagrid.setSelectedRowIndex(null),a.__datagrid.setSrcData(null),a.__updateGrid(),a.__updateTypeAndSeverityCounts(),a.__updateConfirmAllButton()},a.__consumeEventSubscription=function(t){if(t.error===e.Errors.NONE){if(t.event){var n;if(t.removedByFilter){if(e.Server.Events.isAlarm(t.event))-1!==(n=a.__events.findIndex(function(n){return e.Server.Events.isAlarm(n)&&n.id===t.event.id}))&&a.__events.splice(n,1),a.__datagrid.getSelectedRowIndex()===n&&a.__datagrid.setSelectedRowIndex(null)}else if(t.changeType===e.Server.Events.ChangeType.AlarmRaised||t.changeType===e.Server.Events.ChangeType.MessageSent)a.__events.push(t.event);else-1!==(n=a.__events.findIndex(function(n){return e.Server.Events.isAlarm(n)&&e.Server.Events.isAlarm(t.event)&&n.id===t.event.id}))&&(a.__events[n]=t.event);a.__updateGrid(),a.__updateTypeAndSeverityCounts(),a.__updateConfirmAllButton()}}else e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+a.getId()+"] Event subscription error: "+e.Log.buildMessage(t.details))},a.__onUserInGroupChanged=function(){a.__setCanConfirm(!0)},a.__onResized=function(){"Left"!==a.__menuBarPosition&&"Right"!==a.__menuBarPosition||a.__fixVerticalMenuBarWidth()},a.__onSelectedItemChanged=function(){a.__processSelectedItem(),e.EventProvider.raise(a.__id+".onFunctionResultChanged",["getSelectedEvent"]),e.EventProvider.raise(a.__id+".onSelectedItemChanged",a.getSelectedEvent())},a.__onFilterPressed=function(){a.__filterPopup||(a.__filterPopup=new n.TcHmiEventGridPopups.FilterPopup(a.__elementFilterPopup[0],a),a.__filterPopup.registerOkButtonHandler(function(){a.__filterInternal=a.__filterPopup.getSettings(),a.__processFilter(),a.__setStoredValue("filter",a.__filterInternal)})),a.__filterPopup.requiresUpdate()&&a.__filterPopup.update(a.__filterInternal),a.__filterPopup.show()},a.__onColumnsPressed=function(){a.__columnsPopup||(a.__columnsPopup=new n.TcHmiEventGridPopups.ColumnsPopup(a.__elementColumnsPopup[0],a),a.__columnsPopup.registerOkButtonHandler(function(){a.__updateColumns(a.__columnsPopup.getSettings()),a.__setStoredValue("columns",a.__internalColumns)})),a.__columnsPopup.requiresUpdate()&&a.__columnsPopup.update(a.__internalColumns),a.__columnsPopup.show()},a.__onConfirmPressed=function(){var t=a.__datagrid.getSelectedRowValue().originalEvent;e.Server.Events.isAlarm(t)&&e.Server.Events.confirmAlarm(t,function(n){n.error!==e.Errors.NONE&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+a.getId()+"] Unable to confirm alarm with id "+t.id+" in domain "+t.domain+". Error: "+e.Log.buildMessage(n.details)),"object"==typeof n.details&&null!==n.details&&n.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&a.__setCanConfirm(!1)})},a.__onConfirmAllPressed=function(){a.__confirmAllPopup||(a.__confirmAllPopup=new n.TcHmiEventGridPopups.ConfirmAllPopup(a.__elementConfirmAllPopup[0],a)),a.__confirmAllPopup.update(a.__events.filter(function(t){return e.Server.Events.isAlarm(t)&&t.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation})),a.__confirmAllPopup.show()},a.__onDoubleclick=function(t){if(a.getIsEnabled()&&e.Access.checkAccess(a,"operate")&&e.Access.checkAccess(a,"viewDetails")&&t.target instanceof Element){for(var n=t.target;n&&!n.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")&&!n.classList.contains("tchmi-datagrid-template-row");)n=n.parentElement;n&&(e.EventProvider.raise(a.__id+".onItemDoubleClicked",a.getSelectedEvent()),a.__showDetails())}},a.__onTouchStart=function(t){if(a.getIsEnabled()&&e.Access.checkAccess(a,"operate")&&e.Access.checkAccess(a,"viewDetails")&&t.target instanceof Element){for(var n=t.target;n&&(!n.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")||!n.classList.contains("tchmi-datagrid-template-row"));)n=n.parentElement;var i=Date.now();n&&(i-a.__doubletapStartTime<300?(e.EventProvider.raise(a.__id+".onItemDoubleClicked",a.getSelectedEvent()),a.__showDetails(),a.__doubletapStartTime=0,t.preventDefault()):a.__doubletapStartTime=i)}},a.__onScroll=function(t){a.getIsEnabled()&&e.Access.checkAccess(a,"operate")&&e.Access.checkAccess(a,"viewDetails")&&(a.__doubletapStartTime=0)},a.__onResolverForColumnsWatchCallback=function(t){!1===a.__isAttached&&a.__suspendObjectResolver("columns"),t.error===e.Errors.NONE?tchmi_equal(t.value,a.__columns)||(a.__columns=t.value,e.EventProvider.raise(a.__id+".onFunctionResultChanged",["getColumns"]),a.__processColumns()):e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+a.getId()+", Attribute=Columns] Resolving symbols from object failed with error: "+e.Log.buildMessage(t.details))},a.__onResolverForFilterWatchCallback=function(t){!1===a.__isAttached&&a.__suspendObjectResolver("filter"),t.error===e.Errors.NONE?tchmi_equal(t.value,a.__filter)||(a.__filter=t.value,a.__filterInternal=t.value||[],e.EventProvider.raise(a.__id+".onFunctionResultChanged",["getFilter"]),a.__processFilter()):e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+a.getId()+", Attribute=Filter] Resolving symbols from object failed with error: "+e.Log.buildMessage(t.details))},a.__onDatagridFunctionResultChanged=function(t,n){var i=["getSorting","getHeaderFontFamily","getHeaderFontSize","getHeaderFontSizeUnit","getHeaderFontStyle","getHeaderFontWeight","getGridFontFamily","getGridFontSize","getGridFontSizeUnit","getGridFontStyle","getGridFontWeight","getHeaderHeight","getHeaderHeightUnit","getRowHeight"],o=n.filter(function(e){return-1!==i.indexOf(e)});o.length>0&&e.EventProvider.raise(a.__id+".onFunctionResultChanged",o)},a.__events=new e.List,a}return __extends(o,i),o.prototype.__previnit=function(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-event-grid-template")),this.__elementGridContainer=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-grid-container"),0===this.__elementGridContainer.length&&(this.__elementGridContainer=this.__elementTemplateRoot.find(".tchmi-event-grid-template-grid-container")),this.__elementMenuBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-menu-bar"),0===this.__elementMenuBar.length&&(this.__elementMenuBar=this.__elementTemplateRoot.find(".tchmi-event-grid-template-menu-bar")),this.__elementTypeToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-type-toggles"),0===this.__elementTypeToggles.length&&(this.__elementTypeToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-type-toggles")),this.__elementSeverityToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-severity-toggles"),0===this.__elementSeverityToggles.length&&(this.__elementSeverityToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-severity-toggles")),this.__elementOptions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-options"),0===this.__elementOptions.length&&(this.__elementOptions=this.__elementMenuBar.find(".tchmi-event-grid-template-options")),this.__elementMessageActions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-event-actions"),0===this.__elementMessageActions.length&&(this.__elementMessageActions=this.__elementMenuBar.find(".tchmi-event-grid-template-event-actions")),this.__elementFilterPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-popup"),0===this.__elementFilterPopup.length&&(this.__elementFilterPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-filter-popup")),this.__elementColumnsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-popup"),0===this.__elementColumnsPopup.length&&(this.__elementColumnsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-columns-popup")),this.__elementDetailsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-details-popup"),0===this.__elementDetailsPopup.length&&(this.__elementDetailsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-details-popup")),this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup"),0===this.__elementConfirmAllPopup.length&&(this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-confirm-all-popup")),0===this.__elementTemplateRoot.length||0===this.__elementGridContainer.length||0===this.__elementMenuBar.length||0===this.__elementTypeToggles.length||0===this.__elementSeverityToggles.length||0===this.__elementOptions.length||0===this.__elementMessageActions.length||0===this.__elementFilterPopup.length||0===this.__elementColumnsPopup.length||0===this.__elementDetailsPopup.length||0===this.__elementConfirmAllPopup.length)throw new Error("Invalid Template.html");var t=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",this.__id+".eventDatagrid",{"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-row-classes-provider":{objectType:"Function",active:!0,fn:"AlarmStateClassesProvider",fnParams:[]}},this);if(!t)throw new Error("Could not create controls for TcHmiEventGrid.");this.__datagrid=t,this.__destroyersToCallOnDetach.push(e.EventProvider.register(t.getId()+".onFunctionResultChanged",this.__onDatagridFunctionResultChanged)),i.prototype.__previnit.call(this)},o.prototype.__init=function(){i.prototype.__init.call(this),this.__initStorage(),this.__onUserInGroupChangedDestroyer=e.EventProvider.register("onUserInGroupChanged",this.__onUserInGroupChanged),this.__processColumns(),this.__elementGridContainer.append(this.__datagrid.getElement());for(var t=0,n=this.__typeTogglesOrder.length;t<n;t++){var o=this.__typeTogglesOrder[t];if(this.__typeToggles.hasOwnProperty(o)){if(!(r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",this.__id+"."+o+"ToggleButton",{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[o],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(l=r.getElement()).addClass("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-"+o.toLowerCase()+"-toggle-button"),l.addClass("tchmi-event-grid-template-"+o.toLowerCase()+"-toggle-button"),this.__typeToggles[o]=r,this.__elementTypeToggles.append(l)}}for(t=0,n=this.__severityTogglesOrder.length;t<n;t++){o=this.__severityTogglesOrder[t];if(this.__severityToggles.hasOwnProperty(o)){if(!(r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",this.__id+"."+o+"ToggleButton",{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[o],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(l=r.getElement()).addClass("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-"+o.toLowerCase()+"-toggle-button"),l.addClass("tchmi-event-grid-template-"+o.toLowerCase()+"-toggle-button"),this.__severityToggles[o]=r,this.__elementSeverityToggles.append(l)}}for(t=0,n=this.__menuBarButtonsOrder.length;t<n;t++){o=this.__menuBarButtonsOrder[t];if(this.__menuBarButtons.hasOwnProperty(o)){var r,l;if(!(r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"."+o+"Button",{"data-tchmi-width":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-tooltip":this.__buttonTooltips[o]},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(l=r.getElement()).addClass("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-"+o.toLowerCase()+"-button"),l.addClass("tchmi-event-grid-template-"+o.toLowerCase()+"-button"),this.__menuBarButtons[o]=r,"confirm"===o||"confirmAll"===o?(r.setIsEnabled(!1),this.__elementMessageActions.append(l)):this.__elementOptions.append(l)}}this.__menuBarButtons.columns&&this.__menuBarButtons.columns.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"configure"}])},o.prototype.__attach=function(){for(var t in i.prototype.__attach.call(this),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__typeToggles)if(this.__typeToggles.hasOwnProperty(t)){var n=e.Server.Events.Type[t.substr(0,1).toUpperCase()+t.substr(1)];this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__typeToggles[t].getId()+".onToggleStateChanged",this.__onTypeToggleStateChanged(this.__typeToggles[t],n)))}for(var t in this.__severityToggles)if(this.__severityToggles.hasOwnProperty(t)){var o=e.Server.Events.Severity[t.substr(0,1).toUpperCase()+t.substr(1)];this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__severityToggles[t].getId()+".onToggleStateChanged",this.__onSeverityToggleStateChanged(this.__severityToggles[t],o)))}this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__datagrid.getId()+".onSelectedItemChanged",this.__onSelectedItemChanged)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.filter.getId()+".onPressed",this.__onFilterPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.columns.getId()+".onPressed",this.__onColumnsPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.confirm.getId()+".onPressed",this.__onConfirmPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.confirmAll.getId()+".onPressed",this.__onConfirmAllPressed)),this.__elementGridContainer[0].addEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].addEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].addEventListener("scroll",this.__onScroll,!0);var r=this.__getStoredValue("filter");r&&(this.__filterInternal=r),this.__processFilter();var l=this.__getStoredValue("columns");l&&this.__updateColumns(l)},o.prototype.__detach=function(){i.prototype.__detach.call(this);for(var e=0,t=this.__destroyersToCallOnDetach.length;e<t;e++)this.__destroyersToCallOnDetach[e]();this.__destroyersToCallOnDetach=[],this.__serverEventConsumerDestroyer&&(this.__serverEventConsumerDestroyer(),this.__serverEventConsumerDestroyer=null),this.__elementGridContainer[0].removeEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].removeEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].removeEventListener("scroll",this.__onScroll),this.__events.clearAll(),this.__datagrid.setSrcData(null)},o.prototype.destroy=function(){this.__keepAlive||(i.prototype.destroy.call(this),this.__onUserInGroupChangedDestroyer&&(this.__onUserInGroupChangedDestroyer(),this.__onUserInGroupChangedDestroyer=null),this.__filterPopup&&(this.__filterPopup.destroy(),this.__filterPopup=null),this.__columnsPopup&&(this.__columnsPopup.destroy(),this.__columnsPopup=null),this.__detailsPopup&&(this.__detailsPopup.destroy(),this.__detailsPopup=null),this.__confirmAllPopup&&(this.__confirmAllPopup.destroy(),this.__confirmAllPopup=null))},o.prototype.__onTypeToggleStateChanged=function(e,t){var n=this;return function(){n.__typesToShow[t]="Active"===e.getToggleState(),n.__updateGrid()}},o.prototype.__onSeverityToggleStateChanged=function(e,t){var n=this;return function(){n.__severitiesToShow[t]="Active"===e.getToggleState(),n.__updateGrid()}},o.prototype.__showDetails=function(){this.__allowDetailsPopup&&(this.__detailsPopup||(this.__detailsPopup=new n.TcHmiEventGridPopups.DetailsPopup(this.__elementDetailsPopup[0],this)),this.__detailsPopup.update(this.__datagrid.getSelectedRowValue()),this.__detailsPopup.show())},o.prototype.__processSelectedItem=function(){var t=this.__datagrid.getSelectedRowValue();if(null===t)this.__menuBarButtons.confirm.setIsEnabled(!1),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.hide();else{var n=t.originalEvent;this.__menuBarButtons.confirm.setIsEnabled(e.Server.Events.isAlarm(n)&&n.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.update(t)}},o.prototype.__updateGrid=function(){var t=this;if(null!==this.__datagrid){var n=this.__events.filter(function(n){return!e.Server.Events.isAlarm(n)&&!e.Server.Events.isMessage(n)||t.__severitiesToShow[n.severity]&&t.__typesToShow[n.type]}).map(function(e){return t.__toEventDisplay(e)});this.__datagrid.setSrcData(n),this.__processSelectedItem()}},o.prototype.__toEventDisplay=function(t){var n={type:t.type,domain:t.domain,name:t.name,timeReceived:t.timeReceived,originalEvent:t};return e.Server.Events.isAlarm(t)||e.Server.Events.isMessage(t)?(n.severity=t.severity,n.sourceDomain=t.sourceDomain,n.text=t.text,n.timeRaised=t.timeRaised,n.params=t.params,n.originalEvent=t,e.Server.Events.isAlarm(t)&&(n.alarmState=t.alarmState,n.id=t.id,n.timeCleared=0===t.timeCleared.getTime()?null:t.timeCleared,n.timeConfirmed=0===t.timeConfirmed.getTime()?null:t.timeConfirmed)):e.Server.Events.isPayload(t)&&void 0!==t.payload&&(n.payload=t.payload),n},o.prototype.__updateTypeAndSeverityCounts=function(){for(var t=this.__events.reduce(function(t,n){return(e.Server.Events.isAlarm(n)||e.Server.Events.isMessage(n))&&t[n.type]++,t},[0,0]),n=0,i=t.length;n<i;n++)this.__typeToggles[e.Server.Events.Type[n].toLowerCase()].setText(t[n].toString());var o=this.__events.reduce(function(t,n){return(e.Server.Events.isAlarm(n)||e.Server.Events.isMessage(n))&&t[n.severity]++,t},[0,0,0,0,0]);for(n=0,i=o.length;n<i;n++)this.__severityToggles[e.Server.Events.Severity[n].toLowerCase()].setText(o[n].toString())},o.prototype.__updateConfirmAllButton=function(){if(this.__menuBarButtons.confirmAll){var t=this.__events.reduce(function(t,n){return e.Server.Events.isAlarm(n)&&n.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation&&t++,t},0);this.__menuBarButtons.confirmAll.setIsEnabled(t>0)}},o.prototype.__initStorage=function(){var e=window.localStorage.getItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id);if(e)try{this.__storage=JSON.parse(e),"object"!=typeof this.__storage&&(this.__storage={})}catch(e){this.__storage={}}else this.__storage={};for(var t in this.__storageValidation)this.__storageValidation[t].expectedResult=this[this.__storageValidation[t].function].apply(this);for(var t in this.__storage)tchmi_equal(this.__storageValidation[t].expectedResult,this.__storage[t].validation.expectedResult)||this.__removeStoredValue(t)},o.prototype.__getStoredValue=function(t){this.__storage||this.__initStorage();var n=e.Server.getCurrentUser(),i=this.__storage[t];if(i)return n?i.users?i.users[n]:void 0:i.anonymousUser},o.prototype.__setStoredValue=function(t,n){this.__storage||this.__initStorage();var i=e.Server.getCurrentUser();this.__storage[t]||(this.__storage[t]={validation:{function:this.__storageValidation[t].function,expectedResult:this.__storageValidation[t].expectedResult}});var o=this.__storage[t];i?(o.users||(o.users={}),o.users[i]=n):o.anonymousUser=n;try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}},o.prototype.__removeStoredValue=function(t){this.__storage||this.__initStorage();var n=this.__storage[t];if(n){var i=e.Server.getCurrentUser();i?n.users?(delete n.users[i],0===Object.keys(n.users).length&&(void 0===n.anonymousUser?delete this.__storage[t]:delete n.users)):void 0===n.anonymousUser&&delete this.__storage[t]:n.users?delete n.anonymousUser:delete this.__storage[t]}if(Object.keys(this.__storage).length>0)try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}else window.localStorage.removeItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id)},o.prototype.setColumns=function(valueNew){var t=e.ValueConverter.toObject(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Columns"));var n=this.__objectResolvers.get("columns");n&&(n.watchDestroyer&&n.watchDestroyer(),n.resolver.destroy());var i=new e.Symbol.ObjectResolver(t);this.__objectResolvers.set("columns",{resolver:i,watchCallback:this.__onResolverForColumnsWatchCallback,watchDestroyer:i.watch(this.__onResolverForColumnsWatchCallback)})},o.prototype.getColumns=function(){return this.__columns},o.prototype.__processColumns=function(){this.__columns?this.__updateColumns(this.__columns):this.__updateColumns([])},o.prototype.__updateColumns=function(e){var t=this;if(this.__internalColumns=e,this.__datagrid){var n=e.map(function(e){var n;return(n=t.__availableColumns[e.columnName]?tchmi_clone_object(t.__availableColumns[e.columnName]):{name:e.columnName,label:void 0!==e.label&&null!==e.label?e.label:e.columnName,control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:50,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"})&&void 0!==e.width&&null!==e.width&&(n.width=e.width,e.widthUnit&&(n.widthUnit=e.widthUnit)),n}).filter(function(e){return void 0!==e});this.__datagrid.setSrcColumn(n)}},o.prototype.setFilter=function(valueNew){var t=e.ValueConverter.toObject(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Filter"));var n=this.__objectResolvers.get("filter");n&&(n.watchDestroyer&&n.watchDestroyer(),n.resolver.destroy());var i=new e.Symbol.ObjectResolver(t);this.__objectResolvers.set("filter",{resolver:i,watchCallback:this.__onResolverForFilterWatchCallback,watchDestroyer:i.watch(this.__onResolverForFilterWatchCallback)})},o.prototype.getFilter=function(){return this.__filter},o.prototype.__processFilter=function(){this.__serverEventConsumerDestroyer&&this.__serverEventConsumerDestroyer(),!TCHMI_DESIGNER&&this.__isAttached&&(this.__serverEventConsumerDestroyer=e.Server.Events.registerConsumer(this.__filterInternal,{list:this.__consumeEventList,subscription:this.__consumeEventSubscription}))},o.prototype.setSorting=function(valueNew){this.__datagrid.setSorting(valueNew),this.__sortingInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getSorting"]),this.__sortingInitialized=!0)},o.prototype.getSorting=function(){return this.__sortingInitialized?this.__datagrid.getSorting():void 0},o.prototype.setHeaderFontFamily=function(valueNew){this.__datagrid.setHeaderFontFamily(valueNew),this.__headerFontFamilyInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontFamily"]),this.__headerFontFamilyInitialized=!0)},o.prototype.getHeaderFontFamily=function(){return this.__headerFontFamilyInitialized?this.__datagrid.getHeaderFontFamily():void 0},o.prototype.setHeaderFontSize=function(valueNew){this.__datagrid.setHeaderFontSize(valueNew),this.__headerFontSizeInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontSize"]),this.__headerFontSizeInitialized=!0)},o.prototype.getHeaderFontSize=function(){return this.__headerFontSizeInitialized?this.__datagrid.getHeaderFontSize():void 0},o.prototype.setHeaderFontSizeUnit=function(valueNew){this.__datagrid.setHeaderFontSizeUnit(valueNew),this.__headerFontSizeUnitInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontSizeUnit"]),this.__headerFontSizeUnitInitialized=!0)},o.prototype.getHeaderFontSizeUnit=function(){return this.__headerFontSizeUnitInitialized?this.__datagrid.getHeaderFontSizeUnit():void 0},o.prototype.setHeaderFontStyle=function(valueNew){this.__datagrid.setHeaderFontStyle(valueNew),this.__headerFontStyleInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontStyle"]),this.__headerFontStyleInitialized=!0)},o.prototype.getHeaderFontStyle=function(){return this.__headerFontStyleInitialized?this.__datagrid.getHeaderFontStyle():void 0},o.prototype.setHeaderFontWeight=function(valueNew){this.__datagrid.setHeaderFontWeight(valueNew),this.__headerFontWeightInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontWeight"]),this.__headerFontWeightInitialized=!0)},o.prototype.getHeaderFontWeight=function(){return this.__headerFontWeightInitialized?this.__datagrid.getHeaderFontWeight():void 0},o.prototype.setGridFontFamily=function(valueNew){this.__datagrid.setGridFontFamily(valueNew),this.__datagrid.setRowNumbersFontFamily(valueNew),this.__gridFontFamilyInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontFamily"]),this.__gridFontFamilyInitialized=!0)},o.prototype.getGridFontFamily=function(){return this.__gridFontFamilyInitialized?this.__datagrid.getGridFontFamily():void 0},o.prototype.setGridFontSize=function(valueNew){this.__datagrid.setGridFontSize(valueNew),this.__datagrid.setRowNumbersFontSize(valueNew),this.__gridFontSizeInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontSize"]),this.__gridFontSizeInitialized=!0)},o.prototype.getGridFontSize=function(){return this.__gridFontSizeInitialized?this.__datagrid.getGridFontSize():void 0},o.prototype.setGridFontSizeUnit=function(valueNew){this.__datagrid.setGridFontSizeUnit(valueNew),this.__datagrid.setRowNumbersFontSizeUnit(valueNew),this.__gridFontSizeUnitInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontSizeUnit"]),this.__gridFontSizeUnitInitialized=!0)},o.prototype.getGridFontSizeUnit=function(){return this.__gridFontSizeUnitInitialized?this.__datagrid.getGridFontSizeUnit():void 0},o.prototype.setGridFontStyle=function(valueNew){this.__datagrid.setGridFontStyle(valueNew),this.__datagrid.setRowNumbersFontStyle(valueNew),this.__gridFontStyleInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontStyle"]),this.__gridFontStyleInitialized=!0)},o.prototype.getGridFontStyle=function(){return this.__gridFontStyleInitialized?this.__datagrid.getGridFontStyle():void 0},o.prototype.setGridFontWeight=function(valueNew){this.__datagrid.setGridFontWeight(valueNew),this.__datagrid.setRowNumbersFontWeight(valueNew),this.__gridFontWeightInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontWeight"]),this.__gridFontWeightInitialized=!0)},o.prototype.getGridFontWeight=function(){return this.__gridFontWeightInitialized?this.__datagrid.getGridFontWeight():void 0},o.prototype.setHeaderHeight=function(valueNew){this.__datagrid.setHeaderHeight(valueNew),this.__headerHeightInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderHeight"]),this.__headerHeightInitialized=!0)},o.prototype.getHeaderHeight=function(){return this.__headerHeightInitialized?this.__datagrid.getHeaderHeight():void 0},o.prototype.setHeaderHeightUnit=function(valueNew){this.__datagrid.setHeaderHeightUnit(valueNew),this.__headerHeightUnitInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderHeightUnit"]),this.__headerHeightUnitInitialized=!0)},o.prototype.getHeaderHeightUnit=function(){return this.__headerHeightUnitInitialized?this.__datagrid.getHeaderHeightUnit():void 0},o.prototype.setRowHeight=function(valueNew){this.__datagrid.setRowHeight(valueNew),this.__rowHeightInitialized||(e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getRowHeight"]),this.__rowHeightInitialized=!0)},o.prototype.getRowHeight=function(){return this.__rowHeightInitialized?this.__datagrid.getRowHeight():void 0},o.prototype.getRowHeightUnit=function(){return"px"},o.prototype.setAllowDetailsPopup=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("AllowDetailsPopup")),t!==this.__allowDetailsPopup&&(this.__allowDetailsPopup=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAllowDetailsPopup"]),this.__processAllowDetailsPopup())},o.prototype.getAllowDetailsPopup=function(){return this.__allowDetailsPopup},o.prototype.__processAllowDetailsPopup=function(){},o.prototype.setShowMenuBar=function(valueNew){var t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ShowMenuBar")),t!==this.__showMenuBar&&(this.__showMenuBar=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getShowMenuBar"]),this.__processShowMenuBar())},o.prototype.getShowMenuBar=function(){return this.__showMenuBar},o.prototype.__processShowMenuBar=function(){this.__showMenuBar?(e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display",null),this.__fixVerticalMenuBarWidth()):e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display","none")},o.prototype.setMenuBarPosition=function(valueNew){var t=e.ValueConverter.toString(valueNew);(null===t||"Top"!==t&&"Bottom"!==t&&"Left"!==t&&"Right"!==t)&&(t=this.getAttributeDefaultValueInternal("MenuBarPosition")),t!==this.__menuBarPosition&&(this.__menuBarPosition=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getMenuBarPosition"]),this.__processMenuBarPosition())},o.prototype.getMenuBarPosition=function(){return this.__menuBarPosition},o.prototype.__processMenuBarPosition=function(){switch(this.__menuBarPosition){case"Top":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction",null),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Bottom":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","column-reverse"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Left":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column");break;case"Right":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row-reverse"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column")}this.__fixVerticalMenuBarWidth()},o.prototype.setButtonFontFamily=function(valueNew){var t=e.ValueConverter.toString(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontFamily")),t!==this.__buttonFontFamily&&(this.__buttonFontFamily=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontFamily"]),this.__processButtonFontFamily())},o.prototype.getButtonFontFamily=function(){return this.__buttonFontFamily},o.prototype.__processButtonFontFamily=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontFamily(this.__buttonFontFamily);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontFamily(this.__buttonFontFamily)},o.prototype.setButtonFontSize=function(valueNew){var t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSize")),t!==this.__buttonFontSize&&(this.__buttonFontSize=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontSize"]),this.__processButtonFontSize())},o.prototype.getButtonFontSize=function(){return this.__buttonFontSize},o.prototype.__processButtonFontSize=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontSize(this.__buttonFontSize);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontSize(this.__buttonFontSize)},o.prototype.setButtonFontSizeUnit=function(valueNew){var t=e.ValueConverter.toDimensionUnit(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSizeUnit")),t!==this.__buttonFontSizeUnit&&(this.__buttonFontSizeUnit=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontSizeUnit"]),this.__processButtonFontSizeUnit())},o.prototype.getButtonFontSizeUnit=function(){return this.__buttonFontSizeUnit},o.prototype.__processButtonFontSizeUnit=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontSizeUnit(this.__buttonFontSizeUnit);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontSizeUnit(this.__buttonFontSizeUnit)},o.prototype.setButtonFontStyle=function(valueNew){var t=e.ValueConverter.toFontStyle(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontStyle")),t!==this.__buttonFontStyle&&(this.__buttonFontStyle=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontStyle"]),this.__processButtonFontStyle())},o.prototype.getButtonFontStyle=function(){return this.__buttonFontStyle},o.prototype.__processButtonFontStyle=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontStyle(this.__buttonFontStyle);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontStyle(this.__buttonFontStyle)},o.prototype.setButtonFontWeight=function(valueNew){var t=e.ValueConverter.toFontWeight(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontWeight")),t!==this.__buttonFontWeight&&(this.__buttonFontWeight=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontWeight"]),this.__processButtonFontWeight())},o.prototype.getButtonFontWeight=function(){return this.__buttonFontWeight},o.prototype.__processButtonFontWeight=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontWeight(this.__buttonFontWeight);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontWeight(this.__buttonFontWeight)},o.prototype.setButtonHeight=function(valueNew){var t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonHeight")),t!==this.__buttonHeight&&(this.__buttonHeight=t,e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonHeight"]),this.__processButtonHeight())},o.prototype.getButtonHeight=function(){return this.__buttonHeight},o.prototype.__processButtonHeight=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&(this.__typeToggles[e].setHeight(this.__buttonHeight),this.__typeToggles[e].setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(var e in this.__severityToggles)this.__severityToggles[e]&&(this.__severityToggles[e].setHeight(this.__buttonHeight),this.__severityToggles[e].setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(var e in this.__menuBarButtons)this.__menuBarButtons[e]&&(this.__menuBarButtons[e].setHeight(this.__buttonHeight),this.__menuBarButtons[e].setWidth(this.__buttonHeight));this.__fixVerticalMenuBarWidth()},o.prototype.getButtonHeightUnit=function(){return"px"},o.prototype.__fixVerticalMenuBarWidth=function(){var t=this.__elementMenuBar.add(this.__elementMenuBar.children());if(e.StyleProvider.setSimpleElementStyle(t,"min-width",null),"Left"===this.__menuBarPosition||"Right"===this.__menuBarPosition)for(var n=t.length-1;n>=0;n--){var i=t[n].lastElementChild;if(i){var o=i.getBoundingClientRect().right-t[n].getBoundingClientRect().left;e.StyleProvider.setSimpleElementStyle(t[n],"min-width",o+"px")}}},o.prototype.getSelectedEvent=function(){if(!this.__datagrid)return null;var e=this.__datagrid.getSelectedRowValue();return e&&e.originalEvent?e.originalEvent:null},o.prototype.__processIsEnabled=function(){i.prototype.__processIsEnabled.call(this),this.getIsEnabled()||this.__hideAllPopups()},o.prototype.__processAccessConfig=function(){i.prototype.__processAccessConfig.call(this),!1!==e.Access.checkAccess(this,"operate")&&!1!==e.Access.checkAccess(this,"observe")||this.__hideAllPopups(),e.Access.checkAccess(this,"configure")||(this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide()),e.Access.checkAccess(this,"viewDetails")||this.__detailsPopup&&this.__detailsPopup.hide()},o.prototype.__hideAllPopups=function(){this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide(),this.__detailsPopup&&this.__detailsPopup.hide(),this.__confirmAllPopup&&this.__confirmAllPopup.hide()},o.prototype.__setCanConfirm=function(e){this.__canConfirm=e,this.__detailsPopup&&this.__detailsPopup.__setCanConfirm(e),this.__menuBarButtons.confirm.getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__menuBarButtons.confirmAll.getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__menuBarButtons.confirm.getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.confirmAll.getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.confirm.setIsEnabled(e),this.__menuBarButtons.confirmAll.setIsEnabled(e)},o.prototype.__getCanConfirm=function(){return this.__canConfirm},o}(e.Controls.System.TcHmiControl);n.TcHmiEventGrid=i}(t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiEventGrid","TcHmi.Controls.Beckhoff",e.Controls.Beckhoff.TcHmiEventGrid)}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(t){!function(t){var n=function(){function t(e,t,n){if(this.__eventDestroyers=[],this.__isShowing=!1,this.__name=t,this.__parentControl=n,this.__element=e,this.__elementContent=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-content")[0],this.__elementFooter=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-footer")[0],!this.__element||!this.__elementContent||!this.__elementFooter)throw new Error("Invalid Template.html")}return t.prototype.show=function(){var t=this;this.__isShowing||(e.TopMostLayer.add(this.__parentControl,$(this.__element),{removeCb:function(){return t.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)},t.prototype.hide=function(){this.__isShowing&&(e.TopMostLayer.remove(this.__parentControl,$(this.__element)),this.__isShowing=!1)},t.prototype.destroy=function(){for(var e=0,t=this.__eventDestroyers.length;e<t;e++)this.__eventDestroyers[e]()},t.prototype.isShowing=function(){return this.__isShowing},t}();t.Popup=n}(t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n,i,o){var r=t.call(this,n,i,o)||this;r.__okHandlers=[],r.__cancelHandlers=[],r.__updateRequired=!0;var l=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",r.__parentControl.getId()+"."+r.__name+".okButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"OK","data-tchmi-tooltip":"Save and apply changes and close the popup"},r.__parentControl),a=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",r.__parentControl.getId()+"."+r.__name+".cancelButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Discard changes and close the popup"},r.__parentControl);if(!l||!a)throw new Error("Could not create controls for SettingsPopup.");return r.__elementFooter.appendChild(l.getElement()[0]),r.__eventDestroyers.push(e.EventProvider.register(l.getId()+".onPressed",function(){r.__onOkPressed()})),r.__elementFooter.appendChild(a.getElement()[0]),r.__eventDestroyers.push(e.EventProvider.register(a.getId()+".onPressed",function(){r.__onCancelPressed()})),r}return __extends(n,t),n.prototype.__onOkPressed=function(){this.__updateRequired=!0;for(var e=!0,t=0,n=this.__okHandlers.length;t<n;t++)!1===this.__okHandlers[t]()&&(e=!1);return e&&this.hide(),e},n.prototype.__onCancelPressed=function(){this.__updateRequired=!0;for(var e=!0,t=0,n=this.__cancelHandlers.length;t<n;t++)!1===this.__cancelHandlers[t]()&&(e=!1);return e&&this.hide(),e},n.prototype.registerOkButtonHandler=function(e){var t=this;return this.__okHandlers.push(e),function(){t.__okHandlers.splice(t.__okHandlers.indexOf(e),1)}},n.prototype.registerCancelButtonHandler=function(e){var t=this;return this.__cancelHandlers.push(e),function(){t.__cancelHandlers.splice(t.__okHandlers.indexOf(e),1)}},n.prototype.update=function(e){this.__settings=tchmi_clone_object(e),this.__updateRequired=!1},n.prototype.getSettings=function(){return this.__settings},n.prototype.requiresUpdate=function(){return this.__updateRequired},n}(t.Popup);t.SettingsPopup=n}(t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n,i){var o=t.call(this,n,"columnsPopup",i)||this;o.__settings=[],o.__availableColumns=new e.List,o.__selectedColumns=new e.List,o.__columns={type:{label:"Type",order:0},severity:{label:"Severity",order:1},alarmState:{label:"Alarm state",order:2},domain:{label:"Domain",order:3},sourceDomain:{label:"Source Domain",order:4},name:{label:"Name",order:5},text:{label:"Text",order:6},timeAndDateRaised:{label:"Time and date raised",order:7},timeRaised:{label:"Time raised",order:8},dateRaised:{label:"Date raised",order:9},timeAndDateConfirmed:{label:"Time and date confirmed",order:10},timeConfirmed:{label:"Time confirmed",order:11},dateConfirmed:{label:"Date confirmed",order:12},timeAndDateCleared:{label:"Time and date cleared",order:13},timeCleared:{label:"Time cleared",order:14},dateCleared:{label:"Date cleared",order:15},"params::":{label:"params::",order:16}},o.__activeElement=null,o.__activeColumn=null,o.__onAvailableColumnClick=function(e){var t=e.target;if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){var n=t.parentElement,i=o.__availableColumns.findIndex(function(e){return e.element===n});if(-1===i)return;0!==o.__availableColumns[i].name.indexOf("params::")?(o.__settings.push({columnName:o.__availableColumns[i].name}),o.__elementSelectedColumns.appendChild(o.__availableColumns[i].element),o.__selectedColumns.push(o.__availableColumns[i]),o.__availableColumns.splice(i,1)):(o.__settings.push({columnName:"params::"}),n=o.__createColumnDiv("params::"),o.__elementSelectedColumns.appendChild(n),o.__selectedColumns.push({name:"params::",element:n})),o.__activateColumn(n)}},o.__onSelectedColumnClick=function(e){var t=e.target;if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column")||t.classList.contains("tchmi-event-grid-template-columns-config-column"))o.__activateColumn(t);else if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){var n=t.parentElement,i=o.__selectedColumns.findIndex(function(e){return e.element===n});if(-1===i)return;o.__settings.splice(i,1);var r=o.__selectedColumns[i];if(o.__selectedColumns.splice(i,1),0!==r.name.indexOf("params::")){o.__availableColumns.push(r),o.__availableColumns.sort(function(e,t){return o.__columns[e.name].order-o.__columns[t.name].order});var l=o.__availableColumns.indexOf(r);-1===l||l>=o.__elementAvailableColumns.children.length?o.__elementAvailableColumns.appendChild(r.element):o.__elementAvailableColumns.insertBefore(r.element,o.__elementAvailableColumns.children[l])}else o.__elementSelectedColumns.removeChild(r.element);o.__activateColumn(null)}},o.__onUpPressed=function(){var e=o.__selectedColumns.findIndex(function(e){return e.element===o.__activeElement});if(-1!==e&&0!==e){var t=o.__settings[e];o.__settings[e]=o.__settings[e-1],o.__settings[e-1]=t;var n=o.__selectedColumns[e];o.__selectedColumns[e]=o.__selectedColumns[e-1],o.__selectedColumns[e-1]=n,o.__activeElement&&o.__activeElement.previousElementSibling&&o.__activeElement.previousElementSibling.insertAdjacentElement("beforebegin",o.__activeElement),o.__updateButtons()}},o.__onDownPressed=function(){var e=o.__selectedColumns.findIndex(function(e){return e.element===o.__activeElement});if(-1!==e&&e!==o.__settings.length-1){var t=o.__settings[e];o.__settings[e]=o.__settings[e+1],o.__settings[e+1]=t;var n=o.__selectedColumns[e];o.__selectedColumns[e]=o.__selectedColumns[e+1],o.__selectedColumns[e+1]=n,o.__activeElement&&o.__activeElement.nextElementSibling&&o.__activeElement.nextElementSibling.insertAdjacentElement("afterend",o.__activeElement),o.__updateButtons()}},o.__onWidthChanged=function(){var text=o.__widthTextbox.getText();if(!text)return o.__widthTextbox.setBackgroundColor(null),void(o.__activeColumn&&void 0!==o.__activeColumn.width&&null!==o.__activeColumn.width&&(delete o.__activeColumn.width,delete o.__activeColumn.widthUnit));var e=parseFloat(text);if(!isNaN(e)&&/^[+-]?\d*\.?\d+(?:[eE][+-]\d+)?$/.test(text)){if(o.__widthTextbox.setBackgroundColor(null),o.__activeColumn&&(o.__activeColumn.width=e,!o.__activeColumn.widthUnit)){var t=o.__widthUnitCombobox.getSelectedValue();t?o.__activeColumn.widthUnit=t:o.__widthUnitCombobox.setSelectedIndex(0)}}else o.__widthTextbox.setBackgroundColor({color:"rgba(255, 0, 0, 1)"})},o.__onWidthUnitChanged=function(){if(o.__activeColumn){var e=o.__widthUnitCombobox.getSelectedValue();e?void 0!==o.__activeColumn.width&&(o.__activeColumn.widthUnit=e):delete o.__activeColumn.widthUnit}},o.__onNameChanged=function(){if(o.__activeColumn&&o.__activeElement&&0===o.__activeColumn.columnName.indexOf("params::")){var e="params::"+(o.__nameTextbox.getText()||"");o.__activeColumn.columnName=e,o.__activeColumn.label||(o.__activeElement.firstChild.nodeValue=e)}},o.__onLabelChanged=function(){if(o.__activeColumn&&o.__activeElement&&0===o.__activeColumn.columnName.indexOf("params::")){var e=o.__labelTextbox.getText();e?o.__activeColumn.label=e:delete o.__activeColumn.label,o.__activeColumn.label?o.__activeElement.firstChild.nodeValue=o.__activeColumn.label:o.__activeColumn.columnName?o.__activeElement.firstChild.nodeValue=o.__activeColumn.columnName:o.__activeElement.firstChild.nodeValue="params::"}},o.__elementAvailableColumns=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-available-columns")[0],o.__elementSelectedColumns=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-selected-columns")[0];var r=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-order-buttons")[0],l=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-width")[0];if(o.__elementColumnName=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-name")[0],o.__elementColumnLabel=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-label")[0],!(o.__elementAvailableColumns&&o.__elementSelectedColumns&&r&&l&&o.__elementColumnName&&o.__elementColumnLabel))throw new Error("Invalid Template.html");for(var a in o.__columns)o.__columns.hasOwnProperty(a)&&o.__availableColumns.push({name:a,element:o.__createColumnDiv(o.__columns[a].label)});o.__availableColumns.sort(function(e,t){return o.__columns[e.name].order-o.__columns[t.name].order});var s=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".upButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column up"},o.__parentControl),_=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".downButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column down"},o.__parentControl),d=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",o.__parentControl.getId()+"."+o.__name+".widthTextbox",{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},o.__parentControl),c=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",o.__parentControl.getId()+"."+o.__name+".widthUnitCombobox",{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-src-data":[{text:"px",value:"px"},{text:"%",value:"%"}],"data-tchmi-content-padding":{left:4,right:4},"data-tchmi-is-enabled":!1},o.__parentControl),m=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",o.__parentControl.getId()+"."+o.__name+".nameTextbox",{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:44,right:3},"data-tchmi-is-enabled":!1},o.__parentControl),h=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",o.__parentControl.getId()+"."+o.__name+".labelTextbox",{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},o.__parentControl);if(!(s&&_&&d&&c&&m&&h))throw new Error("Could not create controls for ColumnsPopup.");o.__upButton=s,o.__downButton=_,o.__widthTextbox=d,o.__widthUnitCombobox=c,o.__nameTextbox=m,o.__labelTextbox=h;var u=s.getElement()[0];u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-up-button"),u.classList.add("tchmi-event-grid-template-move-up-button"),r.appendChild(u),o.__eventDestroyers.push(e.EventProvider.register(s.getId()+".onPressed",o.__onUpPressed));var p=_.getElement()[0];return p.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-down-button"),p.classList.add("tchmi-event-grid-template-move-down-button"),r.appendChild(p),o.__eventDestroyers.push(e.EventProvider.register(_.getId()+".onPressed",o.__onDownPressed)),l.appendChild(d.getElement()[0]),o.__eventDestroyers.push(e.EventProvider.register(d.getId()+".onTextChanged",o.__onWidthChanged)),l.appendChild(c.getElement()[0]),o.__eventDestroyers.push(e.EventProvider.register(c.getId()+".onSelectionChanged",o.__onWidthUnitChanged)),o.__elementColumnName.appendChild(m.getElement()[0]),o.__eventDestroyers.push(e.EventProvider.register(m.getId()+".onTextChanged",o.__onNameChanged)),o.__elementColumnLabel.appendChild(h.getElement()[0]),o.__eventDestroyers.push(e.EventProvider.register(h.getId()+".onTextChanged",o.__onLabelChanged)),o.__elementAvailableColumns.addEventListener("click",o.__onAvailableColumnClick),o.__elementSelectedColumns.addEventListener("click",o.__onSelectedColumnClick),o}return __extends(n,t),n.prototype.destroy=function(){t.prototype.destroy.call(this),this.__elementAvailableColumns.removeEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.removeEventListener("click",this.__onSelectedColumnClick)},n.prototype.update=function(e){var n=this;t.prototype.update.call(this,e);for(var i,o,r=function(t,r){0!==l.__availableColumns[t].name.indexOf("params::")&&-1!==l.__findIndex(e,function(e){return e.columnName===n.__availableColumns[t].name})&&(l.__selectedColumns.push(l.__availableColumns[t]),l.__availableColumns.splice(t,1),t--,r--),i=t,o=r},l=this,a=0,s=this.__availableColumns.length;a<s;a++)r(a,s),a=i,s=o;var _,d,c=function(t,i){0===m.__selectedColumns[t].name.indexOf("params::")?(m.__selectedColumns.splice(t,1),t--,i--):-1===m.__findIndex(e,function(e){return e.columnName===n.__selectedColumns[t].name})&&(m.__availableColumns.push(m.__selectedColumns[t]),m.__selectedColumns.splice(t,1),t--,i--),_=t,d=i},m=this;for(a=0,s=this.__selectedColumns.length;a<s;a++)c(a,s),a=_,s=d;e.filter(function(e){return 0===e.columnName.indexOf("params::")}).forEach(function(e){return n.__selectedColumns.push({name:e.columnName,element:n.__createColumnDiv(e.label||e.columnName||"params::")})}),this.__availableColumns.sort(function(e,t){return n.__columns[e.name].order-n.__columns[t.name].order}),this.__selectedColumns.sort(function(t,i){return n.__findIndex(e,function(e){return e.columnName===t.name})-n.__findIndex(e,function(e){return e.columnName===i.name})});var h=document.createDocumentFragment();for(a=0,s=this.__availableColumns.length;a<s;a++)h.appendChild(this.__availableColumns[a].element);this.__elementAvailableColumns.textContent="",this.__elementAvailableColumns.appendChild(h);var u=document.createDocumentFragment();for(a=0,s=this.__selectedColumns.length;a<s;a++)u.appendChild(this.__selectedColumns[a].element);this.__elementSelectedColumns.textContent="",this.__elementSelectedColumns.appendChild(u),this.__activateColumn(null)},n.prototype.__findIndex=function(e,t){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return n;return-1},n.prototype.__activateColumn=function(e){if(this.__activeElement&&this.__activeElement.classList.remove("active"),e){this.__activeElement=e,e.classList.add("active");var t=this.__selectedColumns.findIndex(function(t){return t.element===e});this.__activeColumn=this.__settings[t]||null}else this.__activeElement=null,this.__activeColumn=null;this.__updateButtons(),this.__updateColumnProperties()},n.prototype.__updateButtons=function(){this.__upButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.firstElementChild),this.__downButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.lastElementChild)},n.prototype.__updateColumnProperties=function(){var e=this,t=function(){e.__nameTextbox.setIsEnabled(!1),e.__labelTextbox.setIsEnabled(!1),e.__elementColumnName.classList.add("hidden"),e.__elementColumnLabel.classList.add("hidden")};if(this.__activeColumn){if(this.__widthTextbox.setIsEnabled(!0),this.__widthUnitCombobox.setIsEnabled(!0),void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width?this.__widthTextbox.setText(this.__activeColumn.width.toString(10)):this.__widthTextbox.setText(null),this.__activeColumn.widthUnit){var n=-1,i=this.__widthUnitCombobox.getSrcData();Array.isArray(i)&&(n=this.__findIndex(i,function(t){return t.value===e.__activeColumn.widthUnit})),this.__widthUnitCombobox.setSelectedIndex(-1!==n?n:null)}else this.__widthUnitCombobox.setSelectedIndex(null);0===this.__activeColumn.columnName.indexOf("params::")?(this.__nameTextbox.setIsEnabled(!0),this.__labelTextbox.setIsEnabled(!0),this.__nameTextbox.setText(this.__activeColumn.columnName.slice("params::".length)),this.__labelTextbox.setText(this.__activeColumn.label||null),this.__elementColumnName.classList.remove("hidden"),this.__elementColumnLabel.classList.remove("hidden")):t()}else this.__widthTextbox.setIsEnabled(!1),this.__widthUnitCombobox.setIsEnabled(!1),this.__widthTextbox.setText(null),this.__widthUnitCombobox.setSelectedIndex(null),t()},n.prototype.__createColumnDiv=function(e){var t=document.createElement("div");t.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column"),t.classList.add("tchmi-event-grid-template-columns-config-column"),t.textContent=e;var n=document.createElement("div");return n.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle"),n.classList.add("tchmi-event-grid-template-columns-config-column-selection-toggle"),t.appendChild(n),t},n}(t.SettingsPopup);t.ColumnsPopup=n}(t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));var TcHmi,__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,a=r.length;l<a;l++,o++)i[o]=r[l];return i};!function(e){!function(t){!function(t){!function(n){var i=function(n){function i(t,i){var o=n.call(this,t,"filterPopup",i)||this;o.__settings=[],o.__localizableEnums=[],o.__rows=[],o.__selectedRows=[],o.__groupInfo=null,o.__ungroupInfo=null,o.__onScroll=function(e){o.__elementFilterTableHeader.scrollLeft=o.__elementFilterTable.scrollLeft},o.__onLocaleChangedDestroyer=null,o.__onLocaleChanged=function(){o.__localizeEnumLabels()},o.__requestId=null;var r=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table-header")[0];r&&(o.__elementFilterTableHeader=r);var l=o.__elementContent.querySelector("th.TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column");l&&(o.__elementIndentationHeader=l);var a=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table")[0];a&&(o.__elementFilterTable=a);var s=o.__elementContent.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table tbody");s&&(o.__elementFilterTableBody=s);var _=o.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-menubar")[0];if(!(r&&l&&a&&s&&_))throw new Error("Invalid Template.html");a.addEventListener("scroll",o.__onScroll);var d=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".addButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Add a filter clause"},o.__parentControl),c=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".removeButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Remove selected filter clauses"},o.__parentControl),m=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".groupButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Group selected filter clauses"},o.__parentControl),h=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".ungroupButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Ungroup selected filter clauses"},o.__parentControl);if(!(d&&c&&m&&h))throw new Error("Could not create controls for FilterPopup.");c.setIsEnabled(!1),m.setIsEnabled(!1),h.setIsEnabled(!1);var u=d.getElement()[0];u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-add-button"),u.classList.add("tchmi-event-grid-template-add-button"),_.appendChild(u);var p=c.getElement()[0];p.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-remove-button"),p.classList.add("tchmi-event-grid-template-remove-button"),_.appendChild(p);var g=m.getElement()[0];g.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-group-button"),g.classList.add("tchmi-event-grid-template-group-button"),_.appendChild(g);var v=h.getElement()[0];v.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-ungroup-button"),v.classList.add("tchmi-event-grid-template-ungroup-button"),_.appendChild(v),o.__eventDestroyers.push(e.EventProvider.register(d.getId()+".onPressed",function(){o.__add()})),o.__eventDestroyers.push(e.EventProvider.register(c.getId()+".onPressed",function(){o.__remove()})),o.__eventDestroyers.push(e.EventProvider.register(m.getId()+".onPressed",function(){o.__group()})),o.__eventDestroyers.push(e.EventProvider.register(h.getId()+".onPressed",function(){o.__ungroupInfo&&o.__ungroup(o.__ungroupInfo,o.__selectedRows)})),o.__removeButton=c,o.__groupButton=m,o.__ungroupButton=h;var f=o.__parseSchema(e.Type.getSchema("tchmi:server#/definitions/eventFilter"));return o.__schemaInfo=f.schemaInfo,o.__localizableEnums=f.localizationInfo,o.__localizeEnumLabels(),o.__onLocaleChangedDestroyer=e.EventProvider.register("onLocaleChanged",o.__onLocaleChanged),o}return __extends(i,n),i.prototype.update=function(t){var i=this;n.prototype.update.call(this,t),this.__selectedRows=[];var o=document.createDocumentFragment(),r=[],l=0,a={filter:this.__settings,parent:null},s=function(t,n,_){void 0===_&&(_=0);for(var d=0,c=t.length;d<c;d++){var m=t[d];if(e.isLogicOperator(m))n=m;else if(Array.isArray(m)){r.push("first"),l=Math.max(l,r.length),a={filter:m,parent:a},d===c-1?s(m,n,_+1):s(m,n),a.parent&&(a=a.parent)}else if(e.isComparison(m)){if(d===c-1)for(var h=0;h<=_;h++)r[r.length-(h+1)]="last";if(o.appendChild(i.__createRow(r,a,m,n)),d===c-1)r=r.slice(0,-(_+1));else{h=0;for(var u=r.length;h<u;h++)r[h]="middle"}}}};s(this.__settings),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(o),this.__elementIndentationHeader.style.minWidth=l?6*l+5+"px":"1px",this.__processSelection()},i.prototype.hide=function(){n.prototype.hide.call(this),this.__updateRequired&&this.__clear()},i.prototype.destroy=function(){n.prototype.destroy.call(this),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__requestId&&(e.Server.releaseRequest(this.__requestId),this.__requestId=null),this.__clear()},i.prototype.__clear=function(){this.__elementFilterTableBody.innerHTML="";for(var e=0,t=this.__rows.length;e<t;e++){var n=this.__rows[e];n.selection.destroyer(),n.selection.control.destroy(),n.logic&&(n.logic.destroyer(),n.logic.control.destroy()),n.path.destroyer&&n.path.destroyer(),n.path.control&&n.path.control.destroy(),n.comparator.destroyer&&n.comparator.destroyer(),n.comparator.control&&n.comparator.control.destroy(),n.value.destroyer&&n.value.destroyer(),n.value.control&&n.value.control.destroy(),n.value.dateTimePickerEventDestroyer&&n.value.dateTimePickerEventDestroyer(),n.value.dateTimePicker&&n.value.dateTimePicker.destroy(),n.value.dateTimeButtonEventDestroyer&&n.value.dateTimeButtonEventDestroyer(),n.value.dateTimeButton&&n.value.dateTimeButton.destroy()}this.__rows=[]},i.prototype.__createRow=function(t,n,i,o){var r=this,l=document.createElement("tr"),a=document.createElement("td");a.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-selection-column"),a.classList.add("tchmi-event-grid-template-filter-selection-column");var s=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__newControlId(),null,this.__parentControl);if(!s)throw new Error("Could not create controls for FilterPopup.");var _=this.__cloneNesting(n),d=e.EventProvider.register(s.getId()+".onStateChanged",function(e,t){var n={rowElement:l,comparison:i,parent:_};t.state?r.__selectRow(n):r.__deselectRow(n)});a.appendChild(s.getElement()[0]);var c=document.createElement("td");c.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column"),c.classList.add("tchmi-event-grid-template-filter-indentation-column");for(var m=0,h=t.length;m<h;m++){var u=document.createElement("div");u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),u.classList.add("tchmi-event-grid-template-filter-indentation-marker"),u.classList.add(t[m]),c.appendChild(u)}var p=document.createElement("td");p.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column"),p.classList.add("tchmi-event-grid-template-filter-logic-column");var g=document.createElement("td");g.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-path-column"),g.classList.add("tchmi-event-grid-template-filter-path-column");var v=document.createElement("td");v.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-comparator-column"),v.classList.add("tchmi-event-grid-template-filter-comparator-column");var f=document.createElement("td");f.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-value-column"),f.classList.add("tchmi-event-grid-template-filter-value-column");var C={row:l,comparison:i,parent:_,selection:{control:s,destroyer:d},path:{control:null,destroyer:null},comparator:{cell:v,control:null,destroyer:null},value:{cell:f,control:null,destroyer:null,dateTimePicker:null,dateTimePickerEventDestroyer:null,dateTimeButton:null,dateTimeButtonEventDestroyer:null}};if(o){C.logicOperator=o;var y=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic,"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(o.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!y)throw new Error("Could not create controls for FilterPopup.");C.logic={control:y,destroyer:e.EventProvider.register(y.getId()+".onSelectionChanged",function(e,t){o.logic=t.value})},p.appendChild(y.getElement()[0])}var T=Object.keys(this.__schemaInfo.availablePaths);if(T.length>0){var E=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":T,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl);if(!E)throw new Error("Could not create controls for FilterPopup.");C.path.control=E;var b=T.indexOf(i.path||"");-1!==T.indexOf(i.path||"")?E.setSelectedIndex(b):E.setText(i.path),C.path.destroyer=e.EventProvider.register(E.getId()+".onUserInteractionFinished",function(){var path=E.getText();i.path!==path&&(null==path||""===path?delete i.path:i.path=path.toString(),i.value="",r.__updateControls(C))}),g.appendChild(E.getElement()[0])}else{var S=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!S)throw new Error("Could not create controls for FilterPopup.");C.path.control=S,C.path.destroyer=e.EventProvider.register(S.getId()+".onUserInteractionFinished",function(){var path=S.getText();null==path||""===path?delete i.path:i.path=path}),g.appendChild(S.getElement()[0])}return this.__updateControls(C),l.appendChild(a),l.appendChild(c),l.appendChild(p),l.appendChild(g),l.appendChild(v),l.appendChild(f),this.__rows.push(C),l},i.prototype.__updateControls=function(t){var n=this.__schemaInfo.availablePaths[t.comparison.path||""];if(!n&&this.__schemaInfo.freePath&&(n=this.__schemaInfo.freePath),!t.comparator.control){if(t.comparator.control=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!t.comparator.control)throw new Error("Could not create controls for FilterPopup.");t.comparator.destroyer=e.EventProvider.register(t.comparator.control.getId()+".onUserInteractionFinished",function(){var e=t.comparator.control.getText();"string"==typeof e&&""!==e&&(t.comparison.comparator=e)}),t.comparator.cell.appendChild(t.comparator.control.getElement()[0])}var i=t.comparator.control;n?(i.setAllowTextInput(!1),i.setSrcData(n.comparators),i.setSelectedIndex(n.comparators.indexOf(t.comparison.comparator))):i.setAllowTextInput(!0);var o="TcHmi.Controls.Beckhoff.TcHmiTextbox";n&&n.values.length>0&&(o="TcHmi.Controls.Beckhoff.TcHmiCombobox"),t.value.control&&t.value.control.getType()!==o&&(t.value.destroyer&&(t.value.destroyer(),t.value.destroyer=null),t.value.cell.removeChild(t.value.control.getElement()[0]),t.value.control.destroy(),t.value.control=null);var r=!1;if(!t.value.control){if(t.value.control=e.ControlFactory.createEx(o,this.__newControlId(),"TcHmi.Controls.Beckhoff.TcHmiCombobox"===o?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!t.value.control)throw new Error("Could not create controls for FilterPopup.");r=!0,t.value.cell.appendChild(t.value.control.getElement()[0])}switch(o){case"TcHmi.Controls.Beckhoff.TcHmiTextbox":var l=t.value.control,text=void 0;text=t.comparison.value instanceof Date?t.comparison.value.toISOString():t.comparison.value.toString(),l.setText(text),r&&(t.value.destroyer=e.EventProvider.register(l.getId()+".onUserInteractionFinished",function(){var i=l.getText();if(null!=i){switch(n?n.valueType:"any"){case"string":t.comparison.value=e.ValueConverter.toString(i,"");break;case"number":case"integer":t.comparison.value=e.ValueConverter.toNumber(i,0);break;case"boolean":t.comparison.value=e.ValueConverter.toBoolean(i,!1);break;default:t.comparison.value=i}t.value.dateTimePicker&&t.value.dateTimePicker.setValue(i)}}));break;case"TcHmi.Controls.Beckhoff.TcHmiCombobox":var a=t.value.control;if(!n)break;for(var s,_=[],d=0,c=n.values.length;d<c;d++){var m=n.values[d];_.push({value:m,text:n.localizedLabels[m]||m})}if(a.setSrcData(_),a.setAllowTextInput(n.allowFreeValue),a.setSelectedIndex(n.values.indexOf(t.comparison.value)),n.allowFreeValue&&-1===n.values.indexOf(t.comparison.value))s=t.comparison.value instanceof Date?t.comparison.value.toISOString():t.comparison.value.toString(),a.setText(s);r&&(t.value.destroyer=e.EventProvider.register(a.getId()+".onUserInteractionFinished",function(){var i=a.getSelectedValue();if(null==i&&n.allowFreeValue&&(i=a.getText),null!=i)switch(n?n.valueType:"any"){case"string":t.comparison.value=e.ValueConverter.toString(i,"");break;case"number":case"integer":t.comparison.value=e.ValueConverter.toNumber(i,0);break;case"boolean":t.comparison.value=e.ValueConverter.toBoolean(i,!1);break;default:t.comparison.value=i}}))}if(n&&n.valueIsDate){if(!t.value.dateTimePicker){if(t.value.dateTimePicker=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDateTimePicker",this.__newControlId(),{"data-tchmi-visibility":"Collapsed"},this.__parentControl)||null,!t.value.dateTimePicker)throw new Error("Could not create controls for FilterPopup.");t.value.dateTimePickerEventDestroyer=e.EventProvider.register(t.value.dateTimePicker.getId()+".onValueChanged",function(){var e=t.value.dateTimePicker.getValue();e&&(t.value.control&&t.value.control.setText(e),t.comparison.value=e)}),t.value.cell.appendChild(t.value.dateTimePicker.getElement()[0])}if(t.value.dateTimePicker.setValue("string"==typeof t.comparison.value?t.comparison.value:null),!t.value.dateTimeButton){if(t.value.dateTimeButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__newControlId(),{"data-tchmi-width":26,"data-tchmi-height":30},this.__parentControl)||null,!t.value.dateTimeButton)throw new Error("Could not create controls for FilterPopup.");t.value.dateTimeButtonEventDestroyer=e.EventProvider.register(t.value.dateTimeButton.getId()+".onPressed",function(){t.value.dateTimePicker&&t.value.dateTimePicker.openDateTimePicker()});var h=t.value.dateTimeButton.getElement()[0];h.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-date-time-button"),h.classList.add("tchmi-event-grid-template-date-time-button"),t.value.cell.appendChild(h)}}else t.value.dateTimePickerEventDestroyer&&(t.value.dateTimePickerEventDestroyer(),t.value.dateTimePickerEventDestroyer=null),t.value.dateTimePicker&&(t.value.cell.removeChild(t.value.dateTimePicker.getElement()[0]),t.value.dateTimePicker.destroy(),t.value.dateTimePicker=null),t.value.dateTimeButtonEventDestroyer&&(t.value.dateTimeButtonEventDestroyer(),t.value.dateTimeButtonEventDestroyer=null),t.value.dateTimeButton&&(t.value.cell.removeChild(t.value.dateTimeButton.getElement()[0]),t.value.dateTimeButton.destroy(),t.value.dateTimeButton=null)},i.prototype.__selectRow=function(e){this.__selectedRows.push(e),this.__processSelection()},i.prototype.__deselectRow=function(e){for(var t=0,n=this.__selectedRows.length;t<n;t++)if(this.__selectedRows[t].comparison===e.comparison){this.__selectedRows.splice(t,1);break}this.__processSelection()},i.prototype.__add=function(){var path=this.__schemaInfo.freePath?"":Object.keys(this.__schemaInfo.availablePaths)[0],e=this.__schemaInfo.freePath?this.__schemaInfo.freePath:this.__schemaInfo.availablePaths[path],t={logic:this.__schemaInfo.availableLogic[0]},n={path:path,comparator:e.comparators[0],value:e.allowFreeValue?"":e.values[0]};if(this.__selectedRows.length>0){this.__selectedRows.sort(function(e,t){return t.rowElement.rowIndex-e.rowElement.rowIndex});var i=this.__selectedRows[0];i.parent.filter.splice(i.parent.filter.indexOf(i.comparison)+1,0,t,n);for(var o=[],r=i.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),l=0,a=r.length;l<a;l++)"last"===r[l].classList[1]?(r[l].classList.remove("last"),r[l].classList.add("middle"),o.push("last")):o.push("middle");i.rowElement.insertAdjacentElement("afterend",this.__createRow(o,i.parent,n,t))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__settings,parent:null},n,this.__settings.length>0?t:void 0)),this.__settings.length>0&&this.__settings.push(t),this.__settings.push(n);this.__processSelection()},i.prototype.__remove=function(){for(var e=0,t=this.__selectedRows.length;e<t;e++){var n=this.__selectedRows[e],i=n.parent.filter.indexOf(n.comparison);if(-1!==i){for(var o=n.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),r=null,l=0,a=o.length;l<a;l++)if("first"===o[l].classList[1]){if(!r){if(!(s=n.rowElement.nextElementSibling))break;r=s.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}r[l].classList.remove("middle"),r[l].classList.add("first")}else if("last"===o[l].classList[1]){if(!r){var s;if(!(s=n.rowElement.previousElementSibling))break;r=s.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}r[l].classList.remove("middle"),r[l].classList.add("last")}for(var _=-1,d=0,c=this.__rows.length;d<c;d++)if(this.__rows[d].row===n.rowElement){_=d;break}if(-1!==_){var m=this.__rows[_];m.selection.destroyer(),m.selection.control.destroy(),m.logic&&(m.logic.destroyer(),m.logic.control.destroy()),m.path.destroyer&&m.path.destroyer(),m.path.control&&m.path.control.destroy(),m.comparator.destroyer&&m.comparator.destroyer(),m.comparator.control&&m.comparator.control.destroy(),m.value.destroyer&&m.value.destroyer(),m.value.control&&m.value.control.destroy(),m.value.dateTimePickerEventDestroyer&&m.value.dateTimePickerEventDestroyer(),m.value.dateTimePicker&&m.value.dateTimePicker.destroy(),m.value.dateTimeButtonEventDestroyer&&m.value.dateTimeButtonEventDestroyer(),m.value.dateTimeButton&&m.value.dateTimeButton.destroy(),this.__rows.splice(_,1)}if(this.__elementFilterTableBody.removeChild(n.rowElement),n.parent.filter.splice(i,1),i>0)n.parent.filter.splice(i-1,1);else{for(var h=n.parent,u=0;h.parent;){if(-1===(u=h.parent.filter.indexOf(h.filter)))throw new Error("Filter in invalid state. Parent filter does not contain child filter.");if(0!==u)break;h=h.parent}if(0===u){n.parent.filter.length>0&&n.parent.filter.splice(0,1);var p=this.__elementFilterTableBody.firstElementChild;if(p){for(d=0,c=this.__rows.length;d<c;d++)if(this.__rows[d].row===n.rowElement){this.__rows[d].logic&&(this.__rows[d].logic.destroyer(),this.__rows[d].logic.control.destroy(),delete this.__rows[d].logic);break}var g=p.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column .TcHmi_Controls_Beckhoff_TcHmiCombobox");g&&g.parentElement.removeChild(g)}}else h.filter.splice(u-1,1,n.parent.filter.splice(0,1)[0])}if(1===n.parent.filter.length&&n.parent.parent){var v=[];for(d=0,c=this.__rows.length;d<c;d++){for(var f=this.__rows[d].parent;f&&f.filter!==n.parent.filter;)f=f.parent;f&&v.push({rowElement:this.__rows[d].row,comparison:this.__rows[d].comparison,parent:this.__rows[d].parent})}v.length>0&&this.__ungroup({parent:n.parent.parent,toUngroup:n.parent},v)}}}this.__selectedRows=[],this.__processSelection()},i.prototype.__group=function(){if(this.__groupInfo){for(var e=this.__groupInfo.parent.filter.length,t=-1,n=0,i=this.__groupInfo.toGroup.length;n<i;n++){var o=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[n]);if(-1===o)return;e=o<e?o:e,t=o>t?o:t}var r=this.__groupInfo.parent.filter.splice(e,t-e+1);this.__groupInfo.parent.filter.splice(e,0,r),this.__selectedRows.sort(function(e,t){return e.rowElement.rowIndex-t.rowElement.rowIndex});var l={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},a=this.__groupInfo.parent.filter;for(n=0,i=this.__selectedRows.length;n<i;n++){for(var s=this.__selectedRows[n].parent,_=0;s.parent&&s.filter!==a;)s=s.parent,_++;s.filter=r,s.parent=this.__cloneNesting(l);var d=this.__selectedRows[n].rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];if(d){var c=document.createElement("div");c.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),c.classList.add("tchmi-event-grid-template-filter-indentation-marker"),0===n?c.classList.add("first"):n+1===i?c.classList.add("last"):c.classList.add("middle"),d.insertBefore(c,d.childNodes[d.childElementCount-_]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}},i.prototype.__ungroup=function(e,t){var n,i=e.parent.filter.indexOf(e.toUngroup.filter);if(-1!==i){(n=e.parent.filter).splice.apply(n,__spreadArrays([i,1],e.toUngroup.filter)),t.sort(function(e,t){return e.rowElement.rowIndex-t.rowElement.rowIndex});for(var o=0,r=t.length;o<r;o++){for(var l=t[o].parent;l.parent&&l.parent.filter!==e.parent.filter;)l=l.parent;l.filter=e.parent.filter,l.parent=e.parent.parent?this.__cloneNesting(e.parent.parent):null;var a=void 0;(a=0===o?t[o].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.first"):o+1===r?t[o].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.last"):t[o].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.middle"))&&a.parentElement.removeChild(a)}this.__processSelection(),this.__resizeIndentationHeader()}},i.prototype.__processSelection=function(){if(this.__removeButton.setIsEnabled(this.__selectedRows.length>0),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);for(var t=new e.List,n=[],i=function(e,i){var r=o.__selectedRows[e];n[r.rowElement.rowIndex]=!0;var l=t.firstOrDefault(function(e){return e.nesting.filter===r.parent.filter});for(l||(l={nesting:r.parent,itemCount:Math.ceil(r.parent.filter.length/2),selectedItems:[]},t.push(l)),l.selectedItems.push(r.comparison);l.selectedItems.length>=l.itemCount&&(e+1<i||t.length>1);){if(!l.nesting.parent)return o.__groupButton.setIsEnabled(!1),o.__ungroupButton.setIsEnabled(!1),{value:void 0};var a=t.firstOrDefault(function(e){return e.nesting.filter===l.nesting.parent.filter});a||(a={nesting:l.nesting.parent,itemCount:Math.ceil(l.nesting.parent.filter.length/2),selectedItems:[]},t.push(a)),a.selectedItems.push(l.nesting.filter),t.splice(t.indexOf(l),1),l=a}},o=this,r=0,l=this.__selectedRows.length;r<l;r++){var a=i(r,l);if("object"==typeof a)return a.value}if(1===t.length){var s=t[0],_=!0;for(r=n.indexOf(!0),l=n.length;r<l;r++)if(!n[r]){_=!1;break}s.selectedItems.length<s.itemCount&&_?this.__groupInfo={parent:s.nesting,toGroup:s.selectedItems}:s.selectedItems.length===s.itemCount&&s.nesting.parent&&(this.__ungroupInfo={parent:s.nesting.parent,toUngroup:s.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)},i.prototype.__resizeIndentationHeader=function(){var e=this.__elementFilterTableBody.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(e?e.offsetWidth:0)+"px"},i.prototype.__newControlId=function(){return this.__parentControl.getId()+"."+this.__name+"."+tchmi_create_guid()},i.prototype.__cloneNesting=function(e){return{filter:e.filter,parent:e.parent?this.__cloneNesting(e.parent):null}},i.prototype.__parseSchema=function(e){if(e&&"array"===e.type&&e.items){var t=null;if(Array.isArray(e.items)?t=e.items:"object"===e.items.type?t=[e.items]:e.items.anyOf?t=e.items.anyOf:e.items.oneOf&&(t=e.items.oneOf),t){for(var n={availablePaths:{},freePath:null,availableLogic:[]},i=[],o=0,r=t.length;o<r;o++){var l=t[o];if("object"===l.type&&l.properties&&l.properties.logic&&l.properties.logic.enum)for(var a=0,s=l.properties.logic.enum.length;a<s;a++)-1===n.availableLogic.indexOf(l.properties.logic.enum[a])&&n.availableLogic.push(l.properties.logic.enum[a]);else if("object"===l.type&&l.properties&&l.properties.comparator&&l.properties.comparator.enum&&l.properties.value){var _=null;l.properties.path?l.properties.path.enum&&(_=l.properties.path.enum):_=[""];var d=[];if(_)for(a=0,s=_.length;a<s;a++)n.availablePaths[_[a]]||(n.availablePaths[_[a]]={comparators:[],values:[],labels:{},localizedLabels:{},allowFreeValue:!1,valueIsDate:!1,valueType:"any"}),d.push(n.availablePaths[_[a]]);else n.freePath||(n.freePath={comparators:[],values:[],labels:{},localizedLabels:{},allowFreeValue:!1,valueIsDate:!1,valueType:"any"}),d.push(n.freePath);for(a=0,s=d.length;a<s;a++){for(var c=0,m=l.properties.comparator.enum.length;c<m;c++)-1===d[a].comparators.indexOf(l.properties.comparator.enum[c])&&d[a].comparators.push(l.properties.comparator.enum[c]);if("string"!==l.properties.value.type&&"number"!==l.properties.value.type&&"integer"!==l.properties.value.type&&"boolean"!==l.properties.value.type||(d[a].valueType=l.properties.value.type),l.properties.value.enum)for(c=0,m=l.properties.value.enum.length;c<m;c++)-1===d[a].values.indexOf(l.properties.value.enum[c])&&d[a].values.push(l.properties.value.enum[c]);else d[a].allowFreeValue=!0;if(l.properties.value.options){for(c=0,m=l.properties.value.options.length;c<m;c++)d[a].labels[l.properties.value.options[c].value]=l.properties.value.options[c].label,d[a].localizedLabels[l.properties.value.options[c].value]=l.properties.value.options[c].label;i.push(d[a])}"date-time"===l.properties.value.format&&(d[a].valueIsDate=!0)}}}return{schemaInfo:n,localizationInfo:i}}}return{schemaInfo:{availablePaths:{},freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:{},localizedLabels:{},allowFreeValue:!0,valueIsDate:!1,valueType:"any"},availableLogic:["AND","OR"]},localizationInfo:[]}},i.prototype.__localizeEnumLabels=function(){var n=this;if(0!==this.__localizableEnums.length){for(var i={requestType:"ReadWrite",commands:[]},o={},r=0,l=this.__localizableEnums.length;r<l;r++)for(var a in this.__localizableEnums[r].labels){var s=this.__localizableEnums[r].labels[a];o[s]={pathInfo:this.__localizableEnums[r],key:a},i.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:s},commandOptions:["SendWriteValue","SendErrorMessage"]})}this.__requestId=e.Server.requestEx(i,null,function(i){if(n.__requestId=null,i.error===e.Errors.NONE)if(i.response){if(i.response.error)e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Server responds with error. Details: "+e.Log.buildMessage(i.response.error));else if(i.response.commands){for(var r=0,l=i.response.commands.length;r<l;r++)if(i.response.commands[r].error)e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Server responds with error for command for symbol="+i.response.commands[r].symbol+". Details: "+e.Log.buildMessage(i.response.commands[r].error));else{var a=i.response.commands[r].writeValue;"object"==typeof a&&a.name&&o[a.name]&&(o[a.name].pathInfo.localizedLabels[o[a.name].key]=i.response.commands[r].readValue)}for(r=0,l=n.__rows.length;r<l;r++)if(n.__rows[r].value.control instanceof t.TcHmiCombobox){var s=n.__schemaInfo.availablePaths[n.__rows[r].comparison.path||""];if(!s&&n.__schemaInfo.freePath&&(s=n.__schemaInfo.freePath),!s)return;for(var _=n.__rows[r].value.control,d=[],c=0,m=s.values.length;c<m;c++){var h=s.values[c];d.push({value:h,text:s.localizedLabels[h]||h})}var u=_.getSelectedIndex();_.setSrcData(d),_.setSelectedIndex(void 0===u?null:u)}}}else e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Server responds incomplete: response missing. ");else e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Unable to localize text: "+e.Log.buildMessage(i.details))})}},i}(n.SettingsPopup);n.FilterPopup=i}(t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n,i){var o=t.call(this,n,"detailsPopup",i)||this;o.__event=null;var r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".confirmButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Confirm this alarm"},o.__parentControl),l=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",o.__parentControl.getId()+"."+o.__name+".closeButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Close","data-tchmi-tooltip":"Close popup"},o.__parentControl);if(!r||!l)throw new Error("Could not create controls for DetailsPopup.");o.__confirmButton=r;var a=o.__confirmButton.getElement()[0];return a.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-button"),a.classList.add("tchmi-event-grid-template-confirm-button"),o.__elementFooter.appendChild(a),o.__eventDestroyers.push(e.EventProvider.register(o.__confirmButton.getId()+".onPressed",function(){o.__event&&e.Server.Events.isAlarm(o.__event.originalEvent)&&e.Server.Events.confirmAlarm(o.__event.originalEvent,function(t){t.error!==e.Errors.NONE&&(e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+o.__parentControl.getId()+"] Unable to confirm alarm with id "+o.__event.id+" in domain "+o.__event.domain+": "+e.Log.buildMessage(t.details)),"object"==typeof t.details&&null!==t.details&&t.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&o.__parentControl.__setCanConfirm(!1))})})),o.__elementFooter.appendChild(l.getElement()[0]),o.__eventDestroyers.push(e.EventProvider.register(l.getId()+".onPressed",function(){return o.hide()})),o.__setCanConfirm(o.__parentControl.__getCanConfirm()),o}return __extends(n,t),n.prototype.update=function(t){this.__event=t;var n=document.createDocumentFragment(),i=document.createElement("dl");n.appendChild(i);var o=function(e,t){var n=document.createElement("dt");n.textContent=e,i.appendChild(n);var o=document.createElement("dd");o.textContent=t||"-",i.appendChild(o)},r=function(t){var n=document.createElement("dl");for(var i in t)if(t.hasOwnProperty(i)){var o=document.createElement("dt");n.appendChild(o),o.textContent=i.slice(0,1).toUpperCase()+i.slice(1).replace(/([A-Z]+)/g," $1");var l=document.createElement("dd");n.appendChild(l);var a=t[i];if(null==a||""===a)l.textContent="-";else if(a instanceof Date)l.textContent=e.Localization.formatDate(a);else if("object"==typeof a)l.appendChild(r(a));else if("string"==typeof a){var s=null;try{s=JSON.parse(a)}catch(e){}s&&"object"==typeof s?l.appendChild(r(s)):l.textContent=a}else l.textContent=a}return n};o("Domain",t.domain),t.type!==e.Server.Events.Type.Payload&&(o("Source Domain",t.sourceDomain),o("Text",t.text)),o("Name",t.name);var l="";switch(t.type){case e.Server.Events.Type.Message:l="Message";break;case e.Server.Events.Type.Alarm:l="Alarm";break;case e.Server.Events.Type.Payload:l="Payload"}if(o("Type",l),t.type!==e.Server.Events.Type.Payload){var a="";switch(t.severity){case e.Server.Events.Severity.Verbose:a="Verbose";break;case e.Server.Events.Severity.Info:a="Info";break;case e.Server.Events.Severity.Warning:a="Warning";break;case e.Server.Events.Severity.Error:a="Error";break;case e.Server.Events.Severity.Critical:a="Critical"}if(o("Severity",a),t.type===e.Server.Events.Type.Alarm){var s="";switch(t.alarmState){case e.Server.Events.AlarmState.Raised:s="Raised";break;case e.Server.Events.AlarmState.Confirmed:s="Confirmed";break;case e.Server.Events.AlarmState.Cleared:s="Cleared";break;case e.Server.Events.AlarmState.ClearedAndConfirmed:s="Cleared and Confirmed"}t.originalEvent.confirmationState!==e.Server.Events.ConfirmationState.NotRequired&&t.originalEvent.confirmationState!==e.Server.Events.ConfirmationState.NotSupported||(s+=", no confirmation needed"),o("Alarm State",s)}o("Raised",e.Localization.formatDate(t.timeRaised)),t.type===e.Server.Events.Type.Alarm?(void 0!==t.timeCleared&&null!==t.timeCleared&&t.timeCleared.valueOf()>0?o("Cleared",e.Localization.formatDate(t.timeCleared)):o("Cleared",""),void 0!==t.timeConfirmed&&null!==t.timeConfirmed&&t.timeConfirmed.valueOf()>0?o("Confirmed",e.Localization.formatDate(t.timeConfirmed)):o("Confirmed",""),this.__confirmButton.setIsEnabled(t.originalEvent.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation)):this.__confirmButton.setIsEnabled(!1)}else o("Received",e.Localization.formatDate(t.timeReceived)),this.__confirmButton.setIsEnabled(!1);if(t.type!==e.Server.Events.Type.Payload){var _=document.createElement("dt");i.appendChild(_),_.textContent="Parameters";var d=document.createElement("dd");i.appendChild(d),t.params&&Object.keys(t.params).length>0?d.appendChild(r(t.params)):d.textContent="-"}else{var c=document.createElement("dt");i.appendChild(c),c.textContent="Parameters";var m=document.createElement("dd");i.appendChild(m),void 0!==t.payload&&null!==t.payload?t.payload instanceof Date?m.textContent=e.Localization.formatDate(t.payload):"object"==typeof t.payload?m.appendChild(r(t.payload)):m.textContent=t.payload:m.textContent="-"}this.__elementContent.textContent="",this.__elementContent.appendChild(n)},n.prototype.getEvent=function(){return this.__event},n.prototype.__setCanConfirm=function(e){this.__confirmButton.getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__confirmButton.getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__confirmButton.setIsEnabled(e)},n}(t.Popup);t.DetailsPopup=n}(t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(n){!function(n){var i=function(n){function i(i,o){var r=n.call(this,i,"confirmAllPopup",o)||this;if(r.__alarms=[],r.__elementAlarmCount=r.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup-alarm-count")[0],!r.__elementAlarmCount)throw new Error("Invalid Template.html");var l=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",r.__parentControl.getId()+"."+r.__name+".datagrid",{"data-tchmi-src-column":[{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/critical.svg"}]},{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center"},{name:"text",label:"Text",control:"TextBlock",width:300,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"}]},r.__parentControl),a=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",r.__parentControl.getId()+"."+r.__name+".confirmButton",{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":"Yes, confirm all alarms","data-tchmi-tooltip":"Confirm all displayed alarms and close the popup"},r.__parentControl),s=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",r.__parentControl.getId()+"."+r.__name+".closeButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Close the popup without confirming any alarm"},r.__parentControl);if(!l||!a||!s)throw new Error("Could not create controls for ConfirmAllPopup.");return r.__datagrid=l,r.__elementContent.appendChild(r.__datagrid.getElement()[0]),r.__elementFooter.appendChild(a.getElement()[0]),r.__eventDestroyers.push(e.EventProvider.register(a.getId()+".onPressed",function(){for(var t=0,n=r.__alarms.length;t<n;t++)e.Server.Events.confirmAlarm(r.__alarms[t],function(t){t.error!==e.Errors.NONE&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+r.__parentControl.getId()+"] Unable to confirm alarm: "+e.Log.buildMessage(t.details)),"object"==typeof t.details&&null!==t.details&&t.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&r.__parentControl.__setCanConfirm(!1)});r.hide()})),r.__elementFooter.appendChild(s.getElement()[0]),r.__eventDestroyers.push(e.EventProvider.register(s.getId()+".onPressed",function(){return r.hide()})),r}return __extends(i,n),i.prototype.update=function(e){this.__alarms=e,this.__datagrid.setSrcData(this.__alarms),this.__alarms.length>1?this.__elementAlarmCount.textContent="these "+this.__alarms.length+" alarms":this.__elementAlarmCount.textContent="this alarm",this.__elementContent.style.height=30*this.__alarms.length+70+"px"},i.prototype.getAlarms=function(){return this.__alarms},i}(n.Popup);n.ConfirmAllPopup=i}(n.TcHmiEventGridPopups||(n.TcHmiEventGridPopups={}))}(t.Beckhoff||(t.Beckhoff={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));